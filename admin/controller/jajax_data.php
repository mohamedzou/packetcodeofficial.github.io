<?php
/*
 * @ PHP 7.2
 * @ Decoder version : 1.0.0.4
 * @ Release on : 09/06/2021
 * @ Contact    : https://telegram.me/d3v1lrm
 */

$action = $_POST["action"];
$languages = $conn->prepare("SELECT * FROM languages WHERE language_type=:type");
$languages->execute(["type" => 2]);
$languages = $languages->fetchAll(PDO::FETCH_ASSOC);
if ($action == "providers_list") {
    $smmapi = new SMMApi();
    $provider = $_POST["provider"];
    $api = $conn->prepare("SELECT * FROM service_api WHERE id=:id");
    $api->execute(["id" => $provider]);
    $api = $api->fetch(PDO::FETCH_ASSOC);
    if ($api["api_type"] == 3) {
        echo "<div class=\"service-mode__block\">\n          <div class=\"form-group\">\n            <label>Servis</label>\n            <input class=\"form-control\" name=\"service\" placeholder=\"Servis ID giriniz\">\n          </div>\n        </div>";
    } else {
        if ($api["api_type"] == 1) {
            $services = $smmapi->action(["key" => $api["api_key"], "action" => "services"], $api["api_url"]);
            echo "<div class=\"service-mode__block\">\n          <div class=\"form-group\">\n          <label>Servis</label>\n            <select class=\"form-control\" name=\"service\">";
            foreach ($services as $service) {
                echo "<option value=\"" . $service->service . "\"";
                if ($_SESSION["data"]["service"] == $service->service) {
                    echo "selected";
                }
                echo ">" . $service->service . " - " . $service->name . " - " . priceFormat($service->rate) . "</option>";
            }
            echo "</select>\n          </div>\n        </div>";
        }
    }
    unset($_SESSION["data"]);
} else {
    if ($action == "paymentmethod-sortable") {
        $list = $_POST["methods"];
        foreach ($list as $method) {
            $update = $conn->prepare("UPDATE payment_methods SET method_line=:line WHERE id=:id ");
            $update->execute(["id" => $method["id"], "line" => $method["line"]]);
        }
    } else {
        if ($action == "service-sortable") {
            $list = $_POST["services"];
            foreach ($list as $service) {
                $id = explode("-", $service["id"]);
                $update = $conn->prepare("UPDATE services SET service_line=:line WHERE service_id=:id ");
                $update->execute(["id" => $id[1], "line" => $service["line"]]);
            }
        } else {
            if ($action == "category-sortable") {
                $list = $_POST["categories"];
                foreach ($list as $category) {
                    $update = $conn->prepare("UPDATE categories SET category_line=:line WHERE category_id=:id ");
                    $update->execute(["id" => $category["id"], "line" => $category["line"]]);
                }
            } else {
                if ($action == "secret_user") {
                    $id = $_POST["id"];
                    $services = $conn->prepare("SELECT * FROM services RIGHT JOIN categories ON categories.category_id=services.category_id WHERE services.service_secret='1' || categories.category_secret='1'  ");
                    $services->execute(["id" => $id]);
                    $services = $services->fetchAll(PDO::FETCH_ASSOC);
                    $grouped = array_group_by($services, "category_id");
                    $return = "<form class=\"form\" action=\"" . site_url("admin/clients/export") . "\" method=\"post\" data-xhr=\"true\">\n        <div class=\"modal-body\">\n\n        <div class=\"services-import__body\">\n               <div>\n                  <div class=\"services-import__list-wrap services-import__list-active\">\n                     <div class=\"services-import__scroll-wrap\">";
                    foreach ($grouped as $category) {
                        $row = ["table" => "clients_category", "where" => ["client_id" => $id, "category_id" => $category[0]["category_id"]]];
                        $return .= "<span>\n                            <div class=\"services-import__category\">\n                               <div class=\"services-import__category-title\">\n                                 <label> ";
                        if ($category[0]["category_secret"] == 1) {
                            $return .= "<small><i class=\"fa fa-lock\"></i></small> <input type=\"checkbox\"";
                            if (countRow($row)) {
                                $return .= "checked";
                            }
                            $return .= " class=\"tiny-toggle\" data-tt-palette=\"blue\" data-url=\"" . site_url("admin/clients/secret_category/" . $id) . "\" data-id=\"" . $category[0]["category_id"] . "\"> ";
                        }
                        $return .= $category[0]["category_name"] . " </label>\n                               </div>\n                            </div>\n                             <div class=\"services-import__packages\">\n                                <ul>";
                        for ($i = 0; $i < count($category); $i++) {
                            $row = ["table" => "clients_service", "where" => ["client_id" => $id, "service_id" => $category[$i]["service_id"]]];
                            $return .= "<li id=\"service-" . $category[$i]["service_id"] . "\">\n                                     <label>";
                            if ($category[$i]["service_secret"] == 1) {
                                $return .= "<small><i class=\"fa fa-lock\"></i></small> ";
                            }
                            $return .= $category[$i]["service_id"] . " - " . $category[$i]["service_name"] . "\n                                        <span class=\"services-import__packages-price-edit\" >";
                            if ($category[$i]["service_secret"] == 1) {
                                $return .= "<input type=\"checkbox\"";
                                if (countRow($row)) {
                                    $return .= "checked";
                                }
                                $return .= "  class=\"tiny-toggle\" data-tt-palette=\"blue\" data-url=\"" . site_url("admin/clients/secret_service/" . $id) . "\" data-id=\"" . $category[$i]["service_id"] . "\">";
                            }
                            $return .= "</span>\n                                     </label>\n                                    </li>";
                        }
                        $return .= "</ul>\n                             </div>\n                          </span>";
                    }
                    $return .= "</div>\n                  </div>\n               </div>\n            </div>\n            <script src=\"" . site_url("public/admin/") . "jquery.tinytoggle.min.js\"></script>\n            <link rel=\"stylesheet\" type=\"text/css\" href=\"" . site_url("public/admin/") . "tinytoggle.min.css\" rel=\"stylesheet\">\n            <script>\n            \$(\".tiny-toggle\").tinyToggle({\n              onCheck: function() {\n                var id     = \$(this).attr(\"data-id\");\n                var action = \$(this).attr(\"data-url\")+\"?type=on&id=\"+id;\n                  \$.ajax({\n                  url:  action,\n                  type: 'GET',\n                  dataType: 'json',\n                  cache: false,\n                  contentType: false,\n                  processData: false\n                  }).done(function(result){\n                    if( result == 1 ){\n                      \$.toast({\n                          heading: \"Başarılı\",\n                          text: \"İşlem başarılı\",\n                          icon: \"success\",\n                          loader: true,\n                          loaderBg: \"#9EC600\"\n                      });\n                    }else{\n                      \$.toast({\n                          heading: \"Başarısız\",\n                          text: \"İşlem başarısız\",\n                          icon: \"error\",\n                          loader: true,\n                          loaderBg: \"#9EC600\"\n                      });\n                    }\n                  })\n                  .fail(function(){\n                    \$.toast({\n                        heading: \"Başarısız\",\n                        text: \"İşlem başarısız\",\n                        icon: \"error\",\n                        loader: true,\n                        loaderBg: \"#9EC600\"\n                    });\n                  });\n              },\n              onUncheck: function() {\n                var id     = \$(this).attr(\"data-id\");\n                var action = \$(this).attr(\"data-url\")+\"?type=off&id=\"+id;\n                  \$.ajax({\n                  url:  action,\n                  type: 'GET',\n                  dataType: 'json',\n                  cache: false,\n                  contentType: false,\n                  processData: false\n                  }).done(function(result){\n                    if( result == 1 ){\n                      \$.toast({\n                          heading: \"Başarılı\",\n                          text: \"İşlem başarılı\",\n                          icon: \"success\",\n                          loader: true,\n                          loaderBg: \"#9EC600\"\n                      });\n                    }else{\n                      \$.toast({\n                          heading: \"Başarısız\",\n                          text: \"İşlem başarısız\",\n                          icon: \"error\",\n                          loader: true,\n                          loaderBg: \"#9EC600\"\n                      });\n                    }\n                  })\n                  .fail(function(){\n                    \$.toast({\n                        heading: \"Başarısız\",\n                        text: \"İşlem başarısız\",\n                        icon: \"error\",\n                        loader: true,\n                        loaderBg: \"#9EC600\"\n                    });\n                  });\n              },\n            });\n\n            </script>\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                    echo json_encode(["content" => $return, "title" => "Kullanıcıya özel servisler"]);
                } else {
                    if ($action == "new_user") {
                        $return = "<form class=\"form\" action=\"" . site_url("admin/clients/new") . "\" method=\"post\" data-xhr=\"true\">\n        <div class=\"modal-body\">\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Üye adı</label>\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"\">\n          </div>\n\n          <div class=\"form-group\">\n            <label>Üye E-mail</label>\n            <input type=\"text\" name=\"email\" value=\"\" class=\"form-control\">\n          </div>\n\n          <div class=\"form-group\">\n            <label>Kullanıcı adı</label>\n            <input type=\"text\" name=\"username\" class=\"form-control\" value=\"\">\n          </div>\n\n          <div class=\"form-group\">\n            <label>Üye Parolası</label>\n            <div class=\"input-group\">\n              <input type=\"text\" class=\"form-control\" name=\"password\" value=\"\" id=\"user_password\">\n              <span class=\"input-group-btn\">\n                <button class=\"btn btn-default\" onclick=\"UserPassword()\" type=\"button\">\n                <span class=\"fa fa-random\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"\" aria-hidden=\"true\" data-original-title=\"Parola oluştur\"></span></button>\n              </span>\n            </div>\n          </div>\n\n          <div class=\"form-group\">\n            <label>Üye telefon</label>\n            <input type=\"text\" name=\"telephone\" class=\"form-control\" value=\"\">\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Borç durumu</label>\n              <select class=\"form-control\" id=\"debit\" name=\"balance_type\">\n                    <option value=\"2\">Borç yapamasın</option>\n                    <option value=\"1\">Borç yapabilsin</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"form-group\" id=\"debit_limit\">\n            <label>Ne kadar borç yapabilsin</label>\n            <input type=\"text\" name=\"debit_limit\" class=\"form-control\" value=\"\">\n          </div>\n          \n          <div class=\"service-mode__block\" >\n            <div class=\"form-group\" style=\"display: none;\">\n            <label>SMS Onayı</label>\n              <select class=\"form-control\" name=\"tel_type\">\n                    <option value=\"1\" selected>Onaysız</option>\n                    <option value=\"2\">Onaylı</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\" style=\"display\": none\">\n            <label>E-mail Onayı</label>\n              <select class=\"form-control\" name=\"email_type\">\n                    <option value=\"1\" selected>Onaysız</option>\n                    <option value=\"2\">Onaylı</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Yönetici Hesabı</label>\n              <select class=\"form-control\" name=\"access[admin_access]\">\n                    <option value=\"0\">Hayır</option>\n                    <option value=\"1\">Evet</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Yönetici Yetkileri</label>\n              <div class=\"form-group col-md-12\">\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[users]\"  value=\"0\"> Kullanıcılar\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[orders]\"  value=\"0\"> Siparişler\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[subscriptions]\"  value=\"0\"> Abonelikler\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[dripfeed]\"  value=\"0\"> Drip-feed\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[services]\"  value=\"0\"> Servisler\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[payments]\"  value=\"0\"> Ödemeler\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[tickets]\"  value=\"0\"> Destek sistemi\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[reports]\"  value=\"0\"> İstatistikler\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[general_settings]\"  value=\"0\"> Genel ayarlar\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[pages]\"  value=\"0\"> Sayfalar\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[payments_settings]\"  value=\"0\"> Ödeme ayarları\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[bank_accounts]\"  value=\"0\"> Banka Hesapları\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[payments_bonus]\"  value=\"0\"> Ödeme bonusları\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[alert_settings]\"  value=\"0\"> Bildirim ayarları\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[providers]\"  value=\"0\"> Servis sağlayıcıları\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[themes]\"  value=\"0\"> Tema düzenleyicisi\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[language]\"  value=\"0\"> Dil düzenleyicisi\n                  </label>\n                    <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[meta]\"  value=\"0\"> Meta (SEO) Ayarları\n                  </label>\n\n                        <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[twice]\"  value=\"0\"> Hızlı İşlemler</label>\n                    <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[proxy]\"  value=\"0\"> Proxy</label>\n                        <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[kuponlar]\"  value=\"0\"> Kuponlar</label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[admins]\"  value=\"0\"> Yönetici yetkileri\n                  </label>\n              </div>\n            </div>\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Kullanıcıyı kayıt et</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>\n          <script>\n            var type = \$(\"#debit\").val();\n            if( type == 2 ){\n              \$(\"#debit_limit\").hide();\n            } else{\n              \$(\"#debit_limit\").show();\n            }\n            \$(\"#debit\").change(function(){\n              var type = \$(this).val();\n                if( type == 2 ){\n                  \$(\"#debit_limit\").hide();\n                } else{\n                  \$(\"#debit_limit\").show();\n                }\n            });\n          </script>";
                        echo json_encode(["content" => $return, "title" => "Yeni kullanıcı kaydı"]);
                    } else {
                        if ($action == "edit_user") {
                            $id = $_POST["id"];
                            $user = $conn->prepare("SELECT * FROM clients WHERE client_id=:id ");
                            $user->execute(["id" => $id]);
                            $user = $user->fetch(PDO::FETCH_ASSOC);
                            $access = json_decode($user["access"], true);
                            $return = "<form class=\"form\" action=\"" . site_url("admin/clients/edit/" . $user["username"]) . "\" method=\"post\" data-xhr=\"true\">\n        <div class=\"modal-body\">\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Üye adı</label>\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $user["name"] . "\">\n          </div>\n\n          <div class=\"form-group\">\n            <label>Üye E-mail</label>\n            <input type=\"text\" name=\"email\" value=\"" . $user["email"] . "\" class=\"form-control\">\n          </div>\n\n          <div class=\"form-group\">\n            <label>Kullanıcı adı</label>\n            <input type=\"text\" name=\"username\" class=\"form-control\" readonly value=\"" . $user["username"] . "\">\n          </div>\n\n          <div class=\"form-group\">\n            <label>Üye telefon</label>\n            <input type=\"text\" name=\"telephone\" class=\"form-control\" value=\"" . $user["telephone"] . "\">\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Borç durumu</label>\n              <select class=\"form-control\" id=\"debit\" name=\"balance_type\">\n                    <option value=\"2\"";
                            if ($user["balance_type"] == 2) {
                                $return .= "selected";
                            }
                            $return .= ">Borç yapamasın</option>\n                    <option value=\"1\"";
                            if ($user["balance_type"] == 1) {
                                $return .= "selected";
                            }
                            $return .= ">Borç yapabilsin</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"form-group\" id=\"debit_limit\">\n            <label>Ne kadar borç yapabilsin</label>\n            <input type=\"text\" name=\"debit_limit\" class=\"form-control\" value=\"" . $user["debit_limit"] . "\">\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\" style=\"display: none;\">\n            <label>SMS Onayı</label>\n              <select class=\"form-control\" name=\"tel_type\">\n                    <option value=\"1\"";
                            if ($user["tel_type"] == 1) {
                                $return .= "selected";
                            }
                            $return .= ">Onaysız</option>\n                    <option value=\"2\"";
                            if ($user["tel_type"] == 2) {
                                $return .= "selected";
                            }
                            $return .= ">Onaylı</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\" style=\"display: none;\">\n            <label>E-mail Onayı</label>\n              <select class=\"form-control\" name=\"email_type\">\n                    <option value=\"1\"";
                            if ($user["email_type"] == 1) {
                                $return .= "selected";
                            }
                            $return .= ">Onaysız</option>\n                    <option value=\"2\"";
                            if ($user["email_type"] == 2) {
                                $return .= "selected";
                            }
                            $return .= ">Onaylı</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Yönetici Hesabı</label>\n              <select class=\"form-control\" name=\"access[admin_access]\">\n                    <option value=\"0\"";
                            if ($access["admin_access"] == 0) {
                                $return .= "selected";
                            }
                            $return .= ">Hayır</option>\n                    <option value=\"1\"";
                            if ($access["admin_access"] == 1) {
                                $return .= "selected";
                            }
                            $return .= ">Evet</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Yönetici Yetkileri</label>\n              <div class=\"form-group col-md-12\">\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[users]\"";
                            if ($access["users"] == 1) {
                                $return .= "checked";
                            }
                            $return .= " value=\"1\"> Kullanıcılar\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[orders]\"";
                            if ($access["orders"] == 1) {
                                $return .= "checked";
                            }
                            $return .= "  value=\"1\"> Siparişler\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[subscriptions]\"";
                            if ($access["subscriptions"] == 1) {
                                $return .= "checked";
                            }
                            $return .= "  value=\"1\"> Abonelikler\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[dripfeed]\"";
                            if ($access["dripfeed"] == 1) {
                                $return .= "checked";
                            }
                            $return .= "  value=\"1\"> Drip-feed\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[services]\"";
                            if ($access["services"] == 1) {
                                $return .= "checked";
                            }
                            $return .= "  value=\"1\"> Servisler\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[payments]\"";
                            if ($access["payments"] == 1) {
                                $return .= "checked";
                            }
                            $return .= "  value=\"1\"> Ödemeler\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[tickets]\"";
                            if ($access["tickets"] == 1) {
                                $return .= "checked";
                            }
                            $return .= "  value=\"1\"> Destek sistemi\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[reports]\"";
                            if ($access["reports"] == 1) {
                                $return .= "checked";
                            }
                            $return .= "  value=\"1\"> İstatistikler\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[general_settings]\"";
                            if ($access["general_settings"] == 1) {
                                $return .= "checked";
                            }
                            $return .= "  value=\"1\"> Genel ayarlar\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[pages]\"";
                            if ($access["pages"] == 1) {
                                $return .= "checked";
                            }
                            $return .= "  value=\"1\"> Sayfalar\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[payments_settings]\"";
                            if ($access["payments_settings"] == 1) {
                                $return .= "checked";
                            }
                            $return .= "  value=\"1\"> Ödeme ayarları\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[bank_accounts]\"";
                            if ($access["bank_accounts"] == 1) {
                                $return .= "checked";
                            }
                            $return .= "  value=\"1\"> Banka Hesapları\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[payments_bonus]\"";
                            if ($access["payments_bonus"] == 1) {
                                $return .= "checked";
                            }
                            $return .= "  value=\"1\"> Ödeme bonusları\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[alert_settings]\"";
                            if ($access["alert_settings"] == 1) {
                                $return .= "checked";
                            }
                            $return .= "  value=\"1\"> Bildirim ayarları\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[providers]\"";
                            if ($access["providers"] == 1) {
                                $return .= "checked";
                            }
                            $return .= "  value=\"1\"> Servis sağlayıcıları\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[themes]\"";
                            if ($access["themes"] == 1) {
                                $return .= "checked";
                            }
                            $return .= "  value=\"1\"> Tema düzenleyicisi\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[language]\"";
                            if ($access["language"] == 1) {
                                $return .= "checked";
                            }
                            $return .= "  value=\"1\"> Dil düzenleyicisi\n                  </label>\n                   <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[meta]\"";
                            if ($access["meta"] == 1) {
                                $return .= "checked";
                            }
                            $return .= "  value=\"1\"> Meta (SEO) Ayarları\n                  </label>\n\n                         <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[twice]\"";
                            if ($access["twice"] == 1) {
                                $return .= "checked";
                            }
                            $return .= "  value=\"1\"> Hızlı İşlemler\n                  </label>\n                     <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[proxy]\"";
                            if ($access["proxy"] == 1) {
                                $return .= "checked";
                            }
                            $return .= "  value=\"1\"> Proxy</label>\n                         <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[kuponlar]\"";
                            if ($access["kuponlar"] == 1) {
                                $return .= "checked";
                            }
                            $return .= "  value=\"1\"> Kuponlar\n                  </label>\n                  <label class=\"checkbox-inline col-md-3\">\n                    <input type=\"checkbox\" class=\"access\" name=\"access[admins]\"";
                            if ($access["admins"] == 1) {
                                $return .= "checked";
                            }
                            $return .= "  value=\"1\"> Yönetici yetkileri\n                  </label>\n              </div>\n            </div>\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Kullanıcı bilgilerini güncelle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>\n          <script>\n            var type = \$(\"#debit\").val();\n            if( type == 2 ){\n              \$(\"#debit_limit\").hide();\n            } else{\n              \$(\"#debit_limit\").show();\n            }\n            \$(\"#debit\").change(function(){\n              var type = \$(this).val();\n                if( type == 2 ){\n                  \$(\"#debit_limit\").hide();\n                } else{\n                  \$(\"#debit_limit\").show();\n                }\n            });\n          </script>\n          ";
                            echo json_encode(["content" => $return, "title" => "Kullanıcıyı düzenle"]);
                        } else {
                            if ($action == "pass_user") {
                                $id = $_POST["id"];
                                $user = $conn->prepare("SELECT * FROM clients WHERE client_id=:id ");
                                $user->execute(["id" => $id]);
                                $user = $user->fetch(PDO::FETCH_ASSOC);
                                $return = "<form class=\"form\" action=\"" . site_url("admin/clients/pass/" . $user["username"]) . "\" method=\"post\" data-xhr=\"true\">\n        <div class=\"modal-body\">\n\n          <div class=\"form-group\">\n            <label>Üye Parolası</label>\n            <div class=\"input-group\">\n              <input type=\"text\" class=\"form-control\" name=\"password\" value=\"\" id=\"user_password\">\n              <span class=\"input-group-btn\">\n                <button class=\"btn btn-default\" onclick=\"UserPassword()\" type=\"button\">\n                <span class=\"fa fa-random\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"\" aria-hidden=\"true\" data-original-title=\"Parola oluştur\"></span></button>\n              </span>\n            </div>\n          </div>\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Parolayı güncelle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                echo json_encode(["content" => $return, "title" => "Parola düzenle"]);
                            } else {
                                if ($action == "alert_user") {
                                    $return = "<form class=\"form\" action=\"" . site_url("admin/clients/alert") . "\" method=\"post\" data-xhr=\"true\">\n        <div class=\"modal-body\">\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Bildirim Gönderilecek Üye</label>\n              <select class=\"form-control\" id=\"user_type\" name=\"user_type\">\n                    <option value=\"all\">Tüm üyeler</option>\n                    <option value=\"secret\">Üyeye özel</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"form-group\" id=\"username\">\n            <label>Kullanıcı adı</label>\n            <input type=\"text\" name=\"username\" class=\"form-control\" value=\"\">\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Bildirim Tipi</label>\n              <select class=\"form-control\" id=\"alert_type\" name=\"alert_type\">\n                    <option value=\"email\">E-mail</option>\n                    <option value=\"sms\">SMS</option>\n                </select>\n            </div>\n          </div>\n\n          <div id=\"email\">\n            <div class=\"form-group\">\n              <label>E-mail Başlığı</label>\n              <input type=\"text\" name=\"subject\" class=\"form-control\" value=\"\">\n            </div>\n          </div>\n\n          <div class=\"form-group\" id=\"username\">\n            <label>Bildirim Mesajı</label>\n            <textarea type=\"text\" name=\"message\" class=\"form-control\" rows=\"5\"></textarea>\n          </div>\n\n\n\n        </div>\n        <script type=\"text/javascript\">\n          \$(\"#username\").hide();\n          \$(\"#user_type\").change(function(){\n            var type = \$(this).val();\n            if( type == \"secret\" ){\n              \$(\"#username\").show();\n            } else{\n              \$(\"#username\").hide();\n            }\n          });\n          \$(\"#alert_type\").change(function(){\n            var type = \$(this).val();\n            if( type == \"email\" ){\n              \$(\"#email\").show();\n            } else{\n              \$(\"#email\").hide();\n            }\n          });\n        </script>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Kullanıcılara bildiri geç</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>\n\n          ";
                                    echo json_encode(["content" => $return, "title" => "Kullanıcılara bildirim"]);
                                } else {
                                    if ($action == "new_service") {
                                        $categories = $conn->prepare("SELECT * FROM categories ORDER BY category_line ");
                                        $categories->execute([]);
                                        $categories = $categories->fetchAll(PDO::FETCH_ASSOC);
                                        $providers = $conn->prepare("SELECT * FROM service_api");
                                        $providers->execute([]);
                                        $providers = $providers->fetchAll(PDO::FETCH_ASSOC);
                                        $return = "<form class=\"form\" action=\"" . site_url("admin/services/new-service") . "\" method=\"post\" data-xhr=\"true\">\n        <div class=\"modal-body\">";
                                        if (1 < count($languages)) {
                                            $translationList = "<a class=\"other_services\"> Çeviriler (" . (count($languages) - 1) . ") </a>";
                                        } else {
                                            $translationList = "";
                                        }
                                        foreach ($languages as $language) {
                                            if ($language["default_language"]) {
                                                $return .= "<div class=\"form-group\">\n              <label class=\"form-group__service-name\">Servis adı <span class=\"badge\">" . $language["language_name"] . "</span> " . $translationList . " </label>\n              <input type=\"text\" class=\"form-control\" name=\"name[" . $language["language_code"] . "]\" value=\"" . $multiName[$language["language_code"]] . "\">\n            </div>";
                                                if (1 < count($languages)) {
                                                    $return .= "<div class=\"hidden\" id=\"translationsList\">";
                                                }
                                            } else {
                                                $return .= "<div class=\"form-group\">\n              <label class=\"form-group__service-name\">Servis adı <span class=\"badge\">" . $language["language_name"] . "</span> </label>\n              <input type=\"text\" class=\"form-control\" name=\"name[" . $language["language_code"] . "]\" value=\"" . $multiName[$language["language_code"]] . "\">\n            </div>";
                                            }
                                        }
                                        if (1 < count($languages)) {
                                            $return .= "</div>";
                                        }
                                        $return .= "<div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Servis Kategori</label>\n              <select class=\"form-control\" name=\"category\">\n                    <option value=\"0\">Lütfen kategori seçin..</option>";
                                        foreach ($categories as $category) {
                                            $return .= "<option value=\"" . $category["category_id"] . "\">" . $category["category_name"] . "</option>";
                                        }
                                        $return .= "</select>\n            </div>\n          </div>\n\n          <div class=\"service-mode__wrapper\">\n            <div class=\"service-mode__block\">\n              <div class=\"form-group\">\n              <label>Servis Tipi</label>\n                <select class=\"form-control\" name=\"package\">\n                      <option value=\"1\">Servis</option>\n                      <option value=\"2\">Paket</option>\n                      <option value=\"3\">Özel Yorum</option>\n                      <option value=\"4\">Paket Yorum</option>\n                  </select>\n              </div>\n            </div>\n            <div class=\"service-mode__block\">\n              <div class=\"form-group\">\n              <label>Mod</label>\n                <select class=\"form-control\" name=\"mode\" id=\"serviceMode\">\n                      <option value=\"1\">Manuel</option>\n                      <option value=\"2\">Otomatik (API)</option>\n                  </select>\n              </div>\n            </div>\n\n            <div id=\"autoMode\" style=\"display: none\">\n              <div class=\"service-mode__block\">\n                <div class=\"form-group\">\n                <label>Servis Sağlayıcısı</label>\n                  <select class=\"form-control\" name=\"provider\" id=\"provider\">\n                        <option value=\"0\">Servis sağlayıcı seçiniz...</option>";
                                        foreach ($providers as $provider) {
                                            $return .= "<option value=\"" . $provider["id"] . "\">" . $provider["api_name"] . "</option>";
                                        }
                                        $return .= "</select>\n                </div>\n              </div>\n              <div id=\"provider_service\">\n              </div>\n              <div class=\"service-mode__block\"  style=\"display: none\">\n                <div class=\"form-group\">\n                <label>Alış Fiyatı Üzerinden Fiyatlandır</label>\n                  <select class=\"form-control\" name=\"saleprice_cal\" id=\"saleprice_cal>\n                    <option value=\"normal\">Hayır</option>\n                    <option value=\"percent\">Alış fiyatına % ekle </option>\n                    <option value=\"amount\">Alış fiyatına tutar ekle </option>\n                  </select>\n                </div>\n              </div>\n              <div class=\"form-group\" style=\"display: none\">\n                <label class=\"form-group__service-name\">Fiyat</label>\n                <input type=\"text\" class=\"form-control\" name=\"saleprice\" value=\"\">\n              </div>\n              <div class=\"service-mode__block\">\n                <div class=\"form-group\">\n                <label>Dripfeed</label>\n                  <select class=\"form-control\" name=\"dripfeed\">\n                    <option value=\"1\">Pasif</option>\n                    <option value=\"2\">Aktif</option>\n                  </select>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"service-mode__wrapper\">\n              <div class=\"row\">\n                <div class=\"col-md-6 service-mode__block \">\n                  <div class=\"form-group\">\n                  <label>Instagram profil gizliliği kontrol edilsin mi?</label>\n                    <select class=\"form-control\" name=\"instagram_private\">\n                          <option value=\"1\">Hayır</option>\n                          <option value=\"2\">Evet</option>\n                      </select>\n                  </div>\n                </div>\n                <div class=\"col-md-6 service-mode__block \">\n                  <div class=\"form-group\">\n                  <label>Başlangıç sayısı</label>\n                    <select class=\"form-control\" name=\"start_count\">\n                          <option value=\"none\">Çekilmesin</option>\n                          <option value=\"instagram_follower\">Instagram takipçi sayısı</option>\n                          <option value=\"instagram_photo\">Instagram fotoğraf beğeni sayısı</option>\n                      </select>\n                  </div>\n                </div>\n              </div>\n              <div class=\"row\">\n                <div class=\"col-md-6 service-mode__block \">\n                  <div class=\"form-group\">\n                  <label>Aynı bağlantıya 2.sipariş girilsin mi?</label>\n                    <select class=\"form-control\" name=\"instagram_second\">\n                          <option value=\"2\">Evet</option>\n                          <option value=\"1\">Hayır</option>\n                      </select>\n                  </div>\n                </div>\n              </div>\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Servis fiyatı (1000 adet)</label>\n            <input type=\"text\" class=\"form-control\" name=\"price\" value=\"\">\n          </div>\n\n          <div class=\"row\">\n            <div class=\"col-md-6 form-group\">\n              <label class=\"form-group__service-name\">Minimum sipariş</label>\n              <input type=\"text\" class=\"form-control\" name=\"min\" value=\"\">\n            </div>\n\n            <div class=\"col-md-6 form-group\">\n              <label class=\"form-group__service-name\">Maksimum sipariş</label>\n              <input type=\"text\" class=\"form-control\" name=\"max\" value=\"\">\n            </div>\n          </div>\n\n          <hr>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Sipariş Bağlantı</label>\n              <select class=\"form-control\" name=\"want_username\">\n                  <option value=\"1\">Link</option>\n                  <option value=\"2\">Kullanıcı adı</option>\n              </select>\n            </div>\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Kişiye Özel Servis</label>\n              <select class=\"form-control\" name=\"secret\">\n                  <option value=\"2\">Hayır</option>\n                  <option value=\"1\">Evet</option>\n              </select>\n            </div>\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Servis Hızı</label>\n              <select class=\"form-control\" name=\"speed\">\n                  <option value=\"1\">Yavaş</option>\n                  <option value=\"2\">Bazen Yavaş</option>\n                  <option value=\"3\">Normal</option>\n                  <option value=\"4\">Hızlı</option>\n              </select>\n            </div>\n          </div>\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Yeni servisi ekle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>\n          <script src=\"";
                                        $return .= site_url("public/admin/");
                                        $return .= "script.js\"></script>\n          <script>\n          \$(\".other_services\").click(function(){\n            var control = \$(\"#translationsList\");\n            if( control.attr(\"class\") == \"hidden\" ){\n              control.removeClass(\"hidden\");\n            } else{\n              control.addClass(\"hidden\");\n            }\n          });\n          </script>\n          ";
                                        echo json_encode(["content" => $return, "title" => "Yeni servis ekle"]);
                                    } else {
                                        if ($action == "edit_service") {
                                            $id = $_POST["id"];
                                            $smmapi = new SMMApi();
                                            $categories = $conn->prepare("SELECT * FROM categories ORDER BY category_line ");
                                            $categories->execute([]);
                                            $categories = $categories->fetchAll(PDO::FETCH_ASSOC);
                                            $serviceInfo = $conn->prepare("SELECT * FROM services LEFT JOIN service_api ON service_api.id=services.service_api WHERE services.service_id=:id ");
                                            $serviceInfo->execute(["id" => $id]);
                                            $serviceInfo = $serviceInfo->fetch(PDO::FETCH_ASSOC);
                                            $providers = $conn->prepare("SELECT * FROM service_api");
                                            $providers->execute([]);
                                            $providers = $providers->fetchAll(PDO::FETCH_ASSOC);
                                            $multiName = json_decode($serviceInfo["name_lang"], true);
                                            if (in_array($serviceInfo["service_package"], ["11", "12", "13", "14", "15"])) {
                                                $return = "<form class=\"form\" action=\"" . site_url("admin/services/edit-subscription/" . $serviceInfo["service_id"]) . "\" method=\"post\" data-xhr=\"true\">\n            <div class=\"modal-body\">";
                                                if (1 < count($languages)) {
                                                    $translationList = "<a class=\"other_services\"> Çeviriler (" . (count($languages) - 1) . ") </a>";
                                                } else {
                                                    $translationList = "";
                                                }
                                                foreach ($languages as $language) {
                                                    if ($language["default_language"]) {
                                                        $return .= "\n          <div class=\"form-group\">\n                    <label class=\"form-group__service-name\">Servis adı <span class=\"badge\">" . $language["language_name"] . "</span> " . $translationList . " </label>\n                    <input type=\"text\" class=\"form-control\" name=\"name[" . $language["language_code"] . "]\" value=\"" . $multiName[$language["language_code"]] . "\">\n                  </div>";
                                                        if (1 < count($languages)) {
                                                            $return .= "<div class=\"hidden\" id=\"translationsList\">";
                                                        }
                                                    } else {
                                                        $return .= "<div class=\"form-group\">\n                    <label class=\"form-group__service-name\">Servis adı <span class=\"badge\">" . $language["language_name"] . "</span> </label>\n                    <input type=\"text\" class=\"form-control\" name=\"name[" . $language["language_code"] . "]\" value=\"" . $multiName[$language["language_code"]] . "\">\n                  </div>";
                                                    }
                                                }
                                                if (1 < count($languages)) {
                                                    $return .= "</div>";
                                                }
                                                $return .= "<div class=\"service-mode__block\">\n                <div class=\"form-group\">\n                <label>Servis Kategori</label>\n                  <select class=\"form-control\" name=\"category\">\n                        <option value=\"0\">Lütfen kategori seçin..</option>";
                                                foreach ($categories as $category) {
                                                    $return .= "<option value=\"" . $category["category_id"] . "\"";
                                                    if ($serviceInfo["category_id"] == $category["category_id"]) {
                                                        $return .= "selected";
                                                    }
                                                    $return .= ">" . $category["category_name"] . "</option>";
                                                }
                                                $return .= "</select>\n                </div>\n              </div>\n\n              <div class=\"service-mode__block\">\n                <div class=\"form-group\">\n                <label>Abonelik Tipi</label>\n                  <select class=\"form-control\" disabled  id=\"subscription_package\">\n                        <option value=\"11\"";
                                                if ($serviceInfo["service_package"] == 11) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Instagram Otomatik Beğeni - Sınırsız</option>\n                        <option value=\"12\"";
                                                if ($serviceInfo["service_package"] == 12) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Instagram Otomatik İzlenme - Sınırsız</option>\n                        <option value=\"14\"";
                                                if ($serviceInfo["service_package"] == 14) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Instagram Otomatik Beğeni - Süreli</option>\n                        <option value=\"15\"";
                                                if ($serviceInfo["service_package"] == 15) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Instagram Otomatik İzlenme - Süreli</option>\n                    </select>\n                </div>\n              </div>\n\n              \n\n              <div class=\"service-mode__wrapper\">\n\n                <div class=\"service-mode__block\">\n                  <div class=\"form-group\">\n                  <label>Mod</label>\n                    <select class=\"form-control\" name=\"mode\" id=\"serviceMode\">\n                          <option value=\"2\"";
                                                if ($serviceInfo["service_api"] != 0) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Otomatik (API)</option>\n                      </select>\n                  </div>\n                </div>\n\n\n                <div id=\"autoMode\" style=\"display: none\">\n                  <div class=\"service-mode__block\">\n                    <div class=\"form-group\">\n                    <label>Servis Sağlayıcısı</label>\n                      <select class=\"form-control\" name=\"provider\" id=\"provider\">\n                            <option value=\"0\">Servis sağlayıcı seçiniz...</option>";
                                                foreach ($providers as $provider) {
                                                    $return .= "<option value=\"" . $provider["id"] . "\"";
                                                    if ($serviceInfo["service_api"] == $provider["id"]) {
                                                        $return .= "selected";
                                                    }
                                                    $return .= ">" . $provider["api_name"] . "</option>";
                                                }
                                                $return .= "</select>\n                    </div>\n                  </div>\n                  <div id=\"provider_service\">";
                                                $services = $smmapi->action(["key" => $serviceInfo["api_key"], "action" => "services"], $serviceInfo["api_url"]);
                                                if ($serviceInfo["api_type"] == 1) {
                                                    $return .= "<div class=\"service-mode__block\">\n                      <div class=\"form-group\">\n                      <label>Servis</label>\n                        <select class=\"form-control\" name=\"service\">";
                                                    foreach ($services as $service) {
                                                        $return .= "<option value=\"" . $service->service . "\"";
                                                        if ($serviceInfo["api_service"] == $service->service) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">" . $service->service . " - " . $service->name . " - " . $service->rate . "</option>";
                                                    }
                                                    $return .= "</select>\n                      </div>\n                    </div>";
                                                } else {
                                                    if ($serviceInfo["api_type"] == 3) {
                                                        $return .= "<div class=\"service-mode__block\">\n                      <div class=\"form-group\">\n                      <label>Servis</label>\n                        <input class=\"form-control\" value=\"" . $serviceInfo["api_service"] . "\" name=\"service\">\n                      </div>\n                    </div>";
                                                    }
                                                }
                                                $return .= "</div>\n                </div>\n              </div>\n\n              <div id=\"unlimited\">\n                <div class=\"form-group\">\n                  <label class=\"form-group__service-name\">Servis fiyatı (1000 adet)</label>\n                  <input type=\"text\" class=\"form-control\" name=\"price\" value=\"" . $serviceInfo["service_price"] . "\">\n                </div>\n\n                <div class=\"row\">\n                  <div class=\"col-md-6 form-group\">\n                    <label class=\"form-group__service-name\">Minimum sipariş</label>\n                    <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $serviceInfo["service_min"] . "\">\n                  </div>\n\n                  <div class=\"col-md-6 form-group\">\n                    <label class=\"form-group__service-name\">Maksimum sipariş</label>\n                    <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $serviceInfo["service_max"] . "\">\n                  </div>\n                </div>\n              </div>\n\n              <div id=\"limited\">\n                <div class=\"form-group\">\n                  <label class=\"form-group__service-name\">Servis fiyatı</label>\n                  <input type=\"text\" class=\"form-control\" name=\"limited_price\" value=\"" . $serviceInfo["service_price"] . "\">\n                </div>\n\n\n\n                <div class=\"row\">\n                  <div class=\"col-md-6 form-group\">\n                    <label class=\"form-group__service-name\">Gönderi miktarı</label>\n                    <input type=\"text\" class=\"form-control\" name=\"autopost\" value=\"" . $serviceInfo["service_autopost"] . "\">\n                  </div>\n\n                  <div class=\"col-md-6 form-group\">\n                    <label class=\"form-group__service-name\">Sipariş miktarı</label>\n                    <input type=\"text\" class=\"form-control\" name=\"limited_min\" value=\"" . $serviceInfo["service_min"] . "\">\n                  </div>\n                </div>\n                <div class=\"form-group\">\n                  <label class=\"form-group__service-name\">Paket Süresi <small>(gün)</small></label>\n                  <input type=\"text\" class=\"form-control\" name=\"autotime\" value=\"" . $serviceInfo["service_autotime"] . "\">\n                </div>\n              </div>\n\n              <hr>\n\n              <div class=\"service-mode__block\">\n                <div class=\"form-group\">\n                <label>Kişiye Özel Servis</label>\n                  <select class=\"form-control\" name=\"secret\">\n                      <option value=\"2\"";
                                                if ($serviceInfo["service_secret"] == 2) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Hayır</option>\n                      <option value=\"1\"";
                                                if ($serviceInfo["service_secret"] == 1) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Evet</option>\n                  </select>\n                </div>\n              </div>\n\n              <div class=\"service-mode__block\">\n                <div class=\"form-group\">\n                <label>Servis Hızı</label>\n                  <select class=\"form-control\" name=\"speed\">\n                      <option value=\"1\"";
                                                if ($serviceInfo["service_speed"] == 1) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Yavaş</option>\n                      <option value=\"2\"";
                                                if ($serviceInfo["service_speed"] == 2) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Bazen Yavaş</option>\n                      <option value=\"3\"";
                                                if ($serviceInfo["service_speed"] == 3) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Normal</option>\n                      <option value=\"4\"";
                                                if ($serviceInfo["service_speed"] == 4) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Hızlı</option>\n                  </select>\n                </div>\n              </div>\n\n            </div>\n\n              <div class=\"modal-footer\">\n                <button type=\"submit\" class=\"btn btn-primary\">Abonelik bilgilerini güncelle</button>\n                <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n              </div>\n              </form>\n              <script type=\"text/javascript\">\n              \$(\".other_services\").click(function(){\n                var control = \$(\"#translationsList\");\n                if( control.attr(\"class\") == \"hidden\" ){\n                  control.removeClass(\"hidden\");\n                } else{\n                  control.addClass(\"hidden\");\n                }\n              });\n              var site_url  = \$(\"head base\").attr(\"href\");\n                \$(\"#provider\").change(function(){\n                  var provider = \$(this).val();\n                  getProviderServices(provider,site_url);\n                });\n\n                getProvider();\n                \$(\"#serviceMode\").change(function(){\n                  getProvider();\n                });\n\n                getSalePrice();\n                \$(\"#saleprice_cal\").change(function(){\n                  getSalePrice();\n                });\n\n                getSubscription();\n                \$(\"#subscription_package\").change(function(){\n                  getSubscription();\n                });\n                function getProviderServices(provider,site_url){\n                  if( provider == 0 ){\n                    \$(\"#provider_service\").hide();\n                  }else{\n                    \$.post(site_url+\"admin/ajax_data\",{action:\"providers_list\",provider:provider}).done(function( data ) {\n                      \$(\"#provider_service\").show();\n                      \$(\"#provider_service\").html(data);\n                    }).fail(function(){\n                      alert(\"Hata oluştu!\");\n                    });\n                  }\n                }\n\n                function getProvider(){\n                  var mode = \$(\"#serviceMode\").val();\n                    if( mode == 1 ){\n                      \$(\"#autoMode\").hide();\n                    }else{\n                      \$(\"#autoMode\").show();\n                    }\n                }\n\n                function getSalePrice(){\n                  var type = \$(\"#saleprice_cal\").val();\n                    if( type == \"normal\" ){\n                      \$(\"#saleprice\").hide();\n                      \$(\"#servicePrice\").show();\n                    }else{\n                      \$(\"#saleprice\").show();\n                      \$(\"#servicePrice\").hide();\n                    }\n                }\n\n                function getSubscription(){\n                  var type = \$(\"#subscription_package\").val();\n                    if( type == \"11\" || type == \"12\" ){\n                      \$(\"#unlimited\").show();\n                      \$(\"#limited\").hide();\n                    }else{\n                      \$(\"#unlimited\").hide();\n                      \$(\"#limited\").show();\n                    }\n                }\n              </script>\n              ";
                                                echo json_encode(["content" => $return, "title" => "Abonelik düzenle (ID: " . $serviceInfo["service_id"] . ")"]);
                                            } else {
                                                $return = "\n\n        <form class=\"form\" action=\"" . site_url("admin/services/edit-service/" . $serviceInfo["service_id"]) . "\" method=\"post\" data-xhr=\"true\">\n            <div class=\"modal-body\">";
                                                if (1 < count($languages)) {
                                                    $translationList = "<a class=\"other_services\"> Çeviriler (" . (count($languages) - 1) . ") </a>";
                                                } else {
                                                    $translationList = "";
                                                }
                                                foreach ($languages as $language) {
                                                    if ($language["default_language"]) {
                                                        $return .= "\n\t\t\t\t  <div class=\"form-group\">\n                    <label class=\"form-group__service-name\">Servis adı <span class=\"badge\">" . $language["language_name"] . "</span> " . $translationList . " </label>\n                    <input type=\"text\" class=\"form-control\" name=\"name[" . $language["language_code"] . "]\" value=\"" . $multiName[$language["language_code"]] . "\">\n                  </div>";
                                                        if (1 < count($languages)) {
                                                            $return .= "<div class=\"hidden\" id=\"translationsList\">";
                                                        }
                                                    } else {
                                                        $return .= "<div class=\"form-group\">\n                    <label class=\"form-group__service-name\">Servis adı <span class=\"badge\">" . $language["language_name"] . "</span> </label>\n                    <input type=\"text\" class=\"form-control\" name=\"name[" . $language["language_code"] . "]\" value=\"" . $multiName[$language["language_code"]] . "\">\n                  </div>";
                                                    }
                                                }
                                                if (1 < count($languages)) {
                                                    $return .= "</div>";
                                                }
                                                $return .= "<div class=\"service-mode__block\">\n                <div class=\"form-group\">\n                <label>Servis Kategori</label>\n                  <select class=\"form-control\" name=\"category\">\n                        <option value=\"0\">Lütfen kategori seçin..</option>";
                                                foreach ($categories as $category) {
                                                    $return .= "<option value=\"" . $category["category_id"] . "\"";
                                                    if ($serviceInfo["category_id"] == $category["category_id"]) {
                                                        $return .= "selected";
                                                    }
                                                    $return .= ">" . $category["category_name"] . "</option>";
                                                }
                                                $return .= "</select>\n                </div>\n              </div>\n\n              <div class=\"service-mode__wrapper\">\n                <div class=\"service-mode__block\">\n                  <div class=\"form-group\">\n                  <label>Servis Tipi</label>\n                    <select class=\"form-control\" name=\"package\">\n                          <option value=\"1\"";
                                                if ($serviceInfo["service_package"] == 1) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Servis</option>\n                          <option value=\"2\"";
                                                if ($serviceInfo["service_package"] == 2) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Paket</option>\n                          <option value=\"3\"";
                                                if ($serviceInfo["service_package"] == 3) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Özel Yorum</option>\n                          <option value=\"4\"";
                                                if ($serviceInfo["service_package"] == 4) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Paket Yorum</option>\n                      </select>\n                  </div>\n                </div>\n                <div class=\"service-mode__block\">\n                  <div class=\"form-group\">\n                  <label>Mod</label>\n                    <select class=\"form-control\" name=\"mode\" id=\"serviceMode\">\n                          <option value=\"1\"";
                                                if ($serviceInfo["service_api"] == 0) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Manuel</option>\n                          <option value=\"2\"";
                                                if ($serviceInfo["service_api"] != 0) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Otomatik (API)</option>\n                      </select>\n                  </div>\n                </div>\n\n                <div id=\"autoMode\" style=\"display: none\">\n                  <div class=\"service-mode__block\">\n                    <div class=\"form-group\">\n                    <label>Servis Sağlayıcısı</label>\n                      <select class=\"form-control\" name=\"provider\" id=\"provider\">\n                            <option value=\"0\">Servis sağlayıcı seçiniz...</option>";
                                                foreach ($providers as $provider) {
                                                    $return .= "<option value=\"" . $provider["id"] . "\"";
                                                    if ($serviceInfo["service_api"] == $provider["id"]) {
                                                        $return .= "selected";
                                                    }
                                                    $return .= ">" . $provider["api_name"] . "</option>";
                                                }
                                                $return .= "</select>\n                    </div>\n                  </div>\n                  <div id=\"provider_service\">";
                                                $services = $smmapi->action(["key" => $serviceInfo["api_key"], "action" => "services"], $serviceInfo["api_url"]);
                                                if ($serviceInfo["api_type"] == 1) {
                                                    $return .= "<div class=\"service-mode__block\">\n                        <div class=\"form-group\">\n                        <label>Servis</label>\n                          <select class=\"form-control\" name=\"service\">";
                                                    foreach ($services as $service) {
                                                        $return .= "<option value=\"" . $service->service . "\"";
                                                        if ($serviceInfo["api_service"] == $service->service) {
                                                            $return .= "selected";
                                                        }
                                                        $return .= ">" . $service->service . " - " . $service->name . " - " . $service->rate . "</option>";
                                                    }
                                                    $return .= "</select>\n                        </div>\n                      </div>";
                                                } else {
                                                    if ($serviceInfo["api_type"] == 3) {
                                                        $return .= "<div class=\"service-mode__block\">\n                        <div class=\"form-group\">\n                        <label>Servis</label>\n                          <input class=\"form-control\" value=\"" . $serviceInfo["api_service"] . "\" name=\"service\">\n                        </div>\n                      </div>";
                                                    }
                                                }
                                                $return .= "</div>\n                  <div class=\"service-mode__block\"  style=\"display: none\">\n                    <div class=\"form-group\">\n                    <label>Alış Fiyatı Üzerinden Fiyatlandır</label>\n                      <select class=\"form-control\" name=\"saleprice_cal\" id=\"saleprice_cal>\n                        <option value=\"normal\">Hayır</option>\n                        <option value=\"percent\">Alış fiyatına % ekle </option>\n                        <option value=\"amount\">Alış fiyatına tutar ekle </option>\n                      </select>\n                    </div>\n                  </div>\n                  <div class=\"form-group\" style=\"display: none\">\n                    <label class=\"form-group__service-name\">Fiyat</label>\n                    <input type=\"text\" class=\"form-control\" name=\"saleprice\" value=\"\">\n                  </div>\n                  <div class=\"service-mode__block\">\n                    <div class=\"form-group\">\n                    <label>Dripfeed</label>\n                      <select class=\"form-control\" name=\"dripfeed\">\n                        <option value=\"1\"";
                                                if ($serviceInfo["service_dripfeed"] == 1) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Pasif</option>\n                        <option value=\"2\"";
                                                if ($serviceInfo["service_dripfeed"] == 2) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Aktif</option>\n                      </select>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"service-mode__wrapper\">\n                  <div class=\"row\">\n                    <div class=\"col-md-6 service-mode__block \">\n                      <div class=\"form-group\">\n                      <label>Instagram profil gizliliği kontrol edilsin mi?</label>\n                        <select class=\"form-control\" name=\"instagram_private\">\n                              <option value=\"1\"";
                                                if ($serviceInfo["instagram_private"] == 1) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Hayır</option>\n                              <option value=\"2\"";
                                                if ($serviceInfo["instagram_private"] == 2) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Evet</option>\n                          </select>\n                      </div>\n                    </div>\n                    <div class=\"col-md-6 service-mode__block \">\n                      <div class=\"form-group\">\n                      <label>Başlangıç sayısı</label>\n                        <select class=\"form-control\" name=\"start_count\">\n                              <option value=\"none\"";
                                                if ($serviceInfo["start_count"] == "none") {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Çekilmesin</option>\n                              <option value=\"instagram_follower\"";
                                                if ($serviceInfo["start_count"] == "instagram_follower") {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Instagram takipçi sayısı</option>\n                              <option value=\"instagram_photo\"";
                                                if ($serviceInfo["start_count"] == "instagram_photo") {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Instagram fotoğraf beğeni sayısı</option>\n                          </select>\n                      </div>\n                    </div>\n                  </div>\n                  <div class=\"row\">\n                    <div class=\"col-md-6 service-mode__block \">\n                      <div class=\"form-group\">\n                      <label>Aynı bağlantıya 2.sipariş girilsin mi?</label>\n                        <select class=\"form-control\" name=\"instagram_second\">\n                              <option value=\"2\"";
                                                if ($serviceInfo["instagram_second"] == 2) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Evet</option>\n                              <option value=\"1\"";
                                                if ($serviceInfo["instagram_second"] == 1) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Hayır</option>\n                          </select>\n                      </div>\n                    </div>\n                  </div>\n              </div>\n\n              <div class=\"form-group\">\n                <label class=\"form-group__service-name\">Servis fiyatı (1000 adet)</label>\n                <input type=\"text\" class=\"form-control\" name=\"price\" value=\"" . $serviceInfo["service_price"] . "\">\n              </div>\n\n              <div class=\"row\">\n                <div class=\"col-md-6 form-group\">\n                  <label class=\"form-group__service-name\">Minimum sipariş</label>\n                  <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $serviceInfo["service_min"] . "\">\n                </div>\n\n                <div class=\"col-md-6 form-group\">\n                  <label class=\"form-group__service-name\">Maksimum sipariş</label>\n                  <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $serviceInfo["service_max"] . "\">\n                </div>\n              </div>\n\n              <hr>\n\n              <div class=\"service-mode__block\">\n                <div class=\"form-group\">\n                <label>Sipariş Bağlantı</label>\n                  <select class=\"form-control\" name=\"want_username\">\n                      <option value=\"1\"";
                                                if ($serviceInfo["want_username"] == 1) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Link</option>\n                      <option value=\"2\"";
                                                if ($serviceInfo["want_username"] == 2) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Kullanıcı adı</option>\n                  </select>\n                </div>\n              </div>\n\n              <div class=\"service-mode__block\">\n                <div class=\"form-group\">\n                <label>Kişiye Özel Servis</label>\n                  <select class=\"form-control\" name=\"secret\">\n                      <option value=\"2\"";
                                                if ($serviceInfo["service_secret"] == 2) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Hayır</option>\n                      <option value=\"1\"";
                                                if ($serviceInfo["service_secret"] == 1) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Evet</option>\n                  </select>\n                </div>\n              </div>\n\n              <div class=\"service-mode__block\">\n                <div class=\"form-group\">\n                <label>Servis Hızı</label>\n                  <select class=\"form-control\" name=\"speed\">\n                      <option value=\"1\"";
                                                if ($serviceInfo["service_speed"] == 1) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Yavaş</option>\n                      <option value=\"2\"";
                                                if ($serviceInfo["service_speed"] == 2) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Bazen Yavaş</option>\n                      <option value=\"3\"";
                                                if ($serviceInfo["service_speed"] == 3) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Normal</option>\n                      <option value=\"4\"";
                                                if ($serviceInfo["service_speed"] == 4) {
                                                    $return .= "selected";
                                                }
                                                $return .= ">Hızlı</option>\n                  </select>\n                </div>\n              </div>\n\n            </div>\n\n              <div class=\"modal-footer\">\n                <button type=\"submit\" class=\"btn btn-primary\">Servis bilgilerini güncelle</button>\n                <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n              </div>\n              </form>\n              <script type=\"text/javascript\">\n\n               \$(\".other_services\").click(function(){\n                 var control = \$(\"#translationsList\");\n                 if( control.attr(\"class\") == \"hidden\" ){\n                   control.removeClass(\"hidden\");\n                 } else{\n                   control.addClass(\"hidden\");\n                 }\n               });\n              var site_url  = \$(\"head base\").attr(\"href\");\n                \$(\"#provider\").change(function(){\n                  var provider = \$(this).val();\n                  getProviderServices(provider,site_url);\n                });\n\n                getProvider();\n                \$(\"#serviceMode\").change(function(){\n                  getProvider();\n                });\n\n                getSalePrice();\n                \$(\"#saleprice_cal\").change(function(){\n                  getSalePrice();\n                });\n\n                getSubscription();\n                \$(\"#subscription_package\").change(function(){\n                  getSubscription();\n                });\n                function getProviderServices(provider,site_url){\n                  if( provider == 0 ){\n                    \$(\"#provider_service\").hide();\n                  }else{\n                    \$.post(site_url+\"admin/ajax_data\",{action:\"providers_list\",provider:provider}).done(function( data ) {\n                      \$(\"#provider_service\").show();\n                      \$(\"#provider_service\").html(data);\n                    }).fail(function(){\n                      alert(\"Hata oluştu!\");\n                    });\n                  }\n                }\n\n                function getProvider(){\n                  var mode = \$(\"#serviceMode\").val();\n                    if( mode == 1 ){\n                      \$(\"#autoMode\").hide();\n                    }else{\n                      \$(\"#autoMode\").show();\n                    }\n                }\n\n                function getSalePrice(){\n                  var type = \$(\"#saleprice_cal\").val();\n                    if( type == \"normal\" ){\n                      \$(\"#saleprice\").hide();\n                      \$(\"#servicePrice\").show();\n                    }else{\n                      \$(\"#saleprice\").show();\n                      \$(\"#servicePrice\").hide();\n                    }\n                }\n\n                function getSubscription(){\n                  var type = \$(\"#subscription_package\").val();\n                    if( type == \"11\" || type == \"12\" ){\n                      \$(\"#unlimited\").show();\n                      \$(\"#limited\").hide();\n                    }else{\n                      \$(\"#unlimited\").hide();\n                      \$(\"#limited\").show();\n                    }\n                }\n              </script>\n              ";
                                                echo json_encode(["content" => $return, "title" => "Servis düzenle (ID: " . $serviceInfo["service_id"] . ")"]);
                                            }
                                        } else {
                                            if ($action == "edit_description") {
                                                $id = $_POST["id"];
                                                $smmapi = new SMMApi();
                                                $serviceInfo = $conn->prepare("SELECT * FROM services WHERE service_id=:id ");
                                                $serviceInfo->execute(["id" => $id]);
                                                $serviceInfo = $serviceInfo->fetch(PDO::FETCH_ASSOC);
                                                $multiDesc = json_decode($serviceInfo["description_lang"], true);
                                                $return = "<form class=\"form\" action=\"" . site_url("admin/services/edit-description/" . $serviceInfo["service_id"]) . "\" method=\"post\" data-xhr=\"true\">\n            <div class=\"modal-body\">";
                                                if (1 < count($languages)) {
                                                    $translationList = "<a class=\"other_services\"> Çeviriler (" . (count($languages) - 1) . ") </a>";
                                                } else {
                                                    $translationList = "";
                                                }
                                                foreach ($languages as $language) {
                                                    if ($language["default_language"]) {
                                                        $return .= "<div class=\"form-group\">\n                    <label class=\"form-group__service-name\">Açıklama <span class=\"badge\">" . $language["language_name"] . "</span> " . $translationList . " </label>\n                    <textarea class=\"form-control\" rows=\"5\" name=\"description[" . $language["language_code"] . "]\">" . $multiDesc[$language["language_code"]] . "</textarea>\n                  </div>";
                                                        if (1 < count($languages)) {
                                                            $return .= "<div class=\"hidden\" id=\"translationsList\">";
                                                        }
                                                    } else {
                                                        $return .= "<div class=\"form-group\">\n                    <label class=\"form-group__service-name\">Açıklama <span class=\"badge\">" . $language["language_name"] . "</span> </label>\n                    <textarea class=\"form-control\" rows=\"5\"  name=\"description[" . $language["language_code"] . "]\">" . $multiDesc[$language["language_code"]] . "</textarea>\n                  </div>";
                                                    }
                                                }
                                                if (1 < count($languages)) {
                                                    $return .= "</div>";
                                                }
                                                $return .= "\n\n            </div>\n\n              <div class=\"modal-footer\">\n                <button type=\"submit\" class=\"btn btn-primary\">Açıklamayı güncelle</button>\n                <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n              </div>\n              </form>\n              <script type=\"text/javascript\">\n\n              \$(\".other_services\").click(function(){\n                var control = \$(\"#translationsList\");\n                if( control.attr(\"class\") == \"hidden\" ){\n                  control.removeClass(\"hidden\");\n                } else{\n                  control.addClass(\"hidden\");\n                }\n              });\n\n              </script>\n              ";
                                                echo json_encode(["content" => $return, "title" => "Açıklama düzenle (ID: " . $serviceInfo["service_id"] . ")"]);
                                            } else {
                                                if ($action == "new_subscriptions") {
                                                    $categories = $conn->prepare("SELECT * FROM categories ORDER BY category_line ");
                                                    $categories->execute([]);
                                                    $categories = $categories->fetchAll(PDO::FETCH_ASSOC);
                                                    $providers = $conn->prepare("SELECT * FROM service_api");
                                                    $providers->execute([]);
                                                    $providers = $providers->fetchAll(PDO::FETCH_ASSOC);
                                                    $return = "<form class=\"form\" action=\"" . site_url("admin/services/new-subscription") . "\" method=\"post\" data-xhr=\"true\">\n        <div class=\"modal-body\">";
                                                    if (1 < count($languages)) {
                                                        $translationList = "<a class=\"other_services\"> Çeviriler (" . (count($languages) - 1) . ") </a>";
                                                    } else {
                                                        $translationList = "";
                                                    }
                                                    foreach ($languages as $language) {
                                                        if ($language["default_language"]) {
                                                            $return .= "<div class=\"form-group\">\n              <label class=\"form-group__service-name\">Servis adı <span class=\"badge\">" . $language["language_name"] . "</span> " . $translationList . " </label>\n              <input type=\"text\" class=\"form-control\" name=\"name[" . $language["language_code"] . "]\" value=\"" . $multiName[$language["language_code"]] . "\">\n            </div>";
                                                            if (1 < count($languages)) {
                                                                $return .= "<div class=\"hidden\" id=\"translationsList\">";
                                                            }
                                                        } else {
                                                            $return .= "<div class=\"form-group\">\n              <label class=\"form-group__service-name\">Servis adı <span class=\"badge\">" . $language["language_name"] . "</span> </label>\n              <input type=\"text\" class=\"form-control\" name=\"name[" . $language["language_code"] . "]\" value=\"" . $multiName[$language["language_code"]] . "\">\n            </div>";
                                                        }
                                                    }
                                                    if (1 < count($languages)) {
                                                        $return .= "</div>";
                                                    }
                                                    $return .= "<div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Servis Kategori</label>\n              <select class=\"form-control\" name=\"category\">\n                    <option value=\"0\">Lütfen kategori seçin..</option>";
                                                    foreach ($categories as $category) {
                                                        $return .= "<option value=\"" . $category["category_id"] . "\">" . $category["category_name"] . "</option>";
                                                    }
                                                    $return .= "</select>\n            </div>\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Abonelik Tipi</label>\n              <select class=\"form-control\" name=\"package\" id=\"subscription_package\">\n                    <option value=\"11\">Instagram Otomatik Beğeni - Sınırsız</option>\n                    <option value=\"12\">Instagram Otomatik İzlenme - Sınırsız</option>\n                    <option value=\"14\">Instagram Otomatik Beğeni - Süreli</option>\n                    <option value=\"15\">Instagram Otomatik İzlenme - Süreli</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"service-mode__wrapper\">\n\n            <div class=\"service-mode__block\">\n              <div class=\"form-group\">\n              <label>Mod</label>\n                <select class=\"form-control\" name=\"mode\" id=\"serviceMode\">\n                      <option value=\"2\">Otomatik (API)</option>\n                  </select>\n              </div>\n            </div>\n\n            <div id=\"autoMode\" style=\"display: none\">\n              <div class=\"service-mode__block\">\n                <div class=\"form-group\">\n                <label>Servis Sağlayıcısı</label>\n                  <select class=\"form-control\" name=\"provider\" id=\"provider\">\n                        <option value=\"0\">Servis sağlayıcı seçiniz...</option>";
                                                    foreach ($providers as $provider) {
                                                        $return .= "<option value=\"" . $provider["id"] . "\">" . $provider["api_name"] . "</option>";
                                                    }
                                                    $return .= "</select>\n                </div>\n              </div>\n              <div id=\"provider_service\">\n              </div>\n            </div>\n          </div>\n\n          <div id=\"unlimited\">\n            <div class=\"form-group\">\n              <label class=\"form-group__service-name\">Servis fiyatı (1000 adet)</label>\n              <input type=\"text\" class=\"form-control\" name=\"price\" value=\"\">\n            </div>\n\n            <div class=\"row\">\n              <div class=\"col-md-6 form-group\">\n                <label class=\"form-group__service-name\">Minimum sipariş</label>\n                <input type=\"text\" class=\"form-control\" name=\"min\" value=\"\">\n              </div>\n\n              <div class=\"col-md-6 form-group\">\n                <label class=\"form-group__service-name\">Maksimum sipariş</label>\n                <input type=\"text\" class=\"form-control\" name=\"max\" value=\"\">\n              </div>\n            </div>\n          </div>\n\n          <div id=\"limited\">\n            <div class=\"form-group\">\n              <label class=\"form-group__service-name\">Servis fiyatı</label>\n              <input type=\"text\" class=\"form-control\" name=\"limited_price\" value=\"\">\n            </div>\n\n\n\n            <div class=\"row\">\n              <div class=\"col-md-6 form-group\">\n                <label class=\"form-group__service-name\">Gönderi miktarı</label>\n                <input type=\"text\" class=\"form-control\" name=\"autopost\" value=\"\">\n              </div>\n\n              <div class=\"col-md-6 form-group\">\n                <label class=\"form-group__service-name\">Sipariş miktarı</label>\n                <input type=\"text\" class=\"form-control\" name=\"limited_min\" value=\"\">\n              </div>\n            </div>\n            <div class=\"form-group\">\n              <label class=\"form-group__service-name\">Paket Süresi <small>(gün)</small></label>\n              <input type=\"text\" class=\"form-control\" name=\"autotime\" value=\"\">\n            </div>\n          </div>\n\n          <hr>\n\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Kişiye Özel Servis Servis</label>\n              <select class=\"form-control\" name=\"secret\">\n                  <option value=\"2\">Hayır</option>\n                  <option value=\"1\">Evet</option>\n              </select>\n            </div>\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Servis Hızı</label>\n              <select class=\"form-control\" name=\"speed\">\n                  <option value=\"1\">Yavaş</option>\n                  <option value=\"2\">Bazen Yavaş</option>\n                  <option value=\"3\">Normal</option>\n                  <option value=\"4\">Hızlı</option>\n              </select>\n            </div>\n          </div>\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Yeni aboneliği ekle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>\n          <script type=\"text/javascript\">\n\n          \$(\".other_services\").click(function(){\n            var control = \$(\"#translationsList\");\n            if( control.attr(\"class\") == \"hidden\" ){\n              control.removeClass(\"hidden\");\n            } else{\n              control.addClass(\"hidden\");\n            }\n          });\n\n          var site_url  = \$(\"head base\").attr(\"href\");\n            \$(\"#provider\").change(function(){\n              var provider = \$(this).val();\n              getProviderServices(provider,site_url);\n            });\n\n            getProvider();\n            \$(\"#serviceMode\").change(function(){\n              getProvider();\n            });\n\n            getSalePrice();\n            \$(\"#saleprice_cal\").change(function(){\n              getSalePrice();\n            });\n\n            getSubscription();\n            \$(\"#subscription_package\").change(function(){\n              getSubscription();\n            });\n            function getProviderServices(provider,site_url){\n              if( provider == 0 ){\n                \$(\"#provider_service\").hide();\n              }else{\n                \$.post(site_url+\"admin/ajax_data\",{action:\"providers_list\",provider:provider}).done(function( data ) {\n                  \$(\"#provider_service\").show();\n                  \$(\"#provider_service\").html(data);\n                }).fail(function(){\n                  alert(\"Hata oluştu!\");\n                });\n              }\n            }\n\n            function getProvider(){\n              var mode = \$(\"#serviceMode\").val();\n                if( mode == 1 ){\n                  \$(\"#autoMode\").hide();\n                }else{\n                  \$(\"#autoMode\").show();\n                }\n            }\n\n            function getSalePrice(){\n              var type = \$(\"#saleprice_cal\").val();\n                if( type == \"normal\" ){\n                  \$(\"#saleprice\").hide();\n                  \$(\"#servicePrice\").show();\n                }else{\n                  \$(\"#saleprice\").show();\n                  \$(\"#servicePrice\").hide();\n                }\n            }\n\n            function getSubscription(){\n              var type = \$(\"#subscription_package\").val();\n                if( type == \"11\" || type == \"12\" ){\n                  \$(\"#unlimited\").show();\n                  \$(\"#limited\").hide();\n                }else{\n                  \$(\"#unlimited\").hide();\n                  \$(\"#limited\").show();\n                }\n            }\n          </script>\n          ";
                                                    echo json_encode(["content" => $return, "title" => "Yeni abonelik ekle"]);
                                                } else {
                                                    if ($action == "new_category") {
                                                        $return = "<form class=\"form\" action=\"" . site_url("admin/services/new-category") . "\" method=\"post\" data-xhr=\"true\">\n\n        <div class=\"modal-body\">\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Kategori adı</label>\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"\">\n          </div>\n <div class=\"form-group\">\n\t\t\t\t<label class=\"form-group__service-name\">İcon</label>\n\t\t\t\t  <select class=\"form-control\" name=\"icon\">\n\t\t\t\n\t\t\t\t\t\t<option value=\"\">Yok</option>\n\t\t\t\t\t\t<option value=\"facebook-square\">Facebook</option>\n\t\t\t\t\t\t<option value=\"instagram\">Instagram</option>\n\t\t\t\t\t\t<option value=\"twitter\">Twitter</option>\n\t\t\t\t\t\t<option value=\"twitch\">Twitch</option>\n\t\t\t\t\t\t<option value=\"youtube-play\">Youtube</option>\n\t\t\t\t\t\t<option value=\"snapchat\">Snapchat</option>\n\t\t\t\t\t\t<option value=\"linkedin-square\">Linkedin</option>\n\t\t\t\t\t\t<option value=\"telegram\">Telegram</option>\n\t\t\t\t\t\t<option value=\"spotify\">Spotify</option>\n\t\t\t\t\t\t<option value=\"soundcloud\">Soundcloud</option>\n\t\t\t\t\t\t<option value=\"pinterest\">Pinterest</option>\n\t\t\t\t\t\t<option value=\"google\">Google</option>\n\t\t\t\t\t\t<option value=\"google-plus-official\">Google+</option>\n\t\t\t\t\t\t<option value=\"vk\">VK</option>\n\t\t\t\t\t\t<option value=\"thumbs-up\">Like</option>\n\t\t\t\t\t\t<option value=\"thumbs-down\">Dislike</option>\n\t\t\t\t\t\t<option value=\"user-plus\">Follower</option>\n\t\t\t\t\t\t<option value=\"comment\">Comment</option>\n\t\t\t\t\t\t<option value=\"align-justify\">Post</option>\n\t\t\t\t\t\t<option value=\"eye\">View</option>\n\t\t\t\t\t\t<option value=\"hashtag\">Hashtag</option>\n\t\t\t\t\t\t<option value=\"smile\">Smile</option>\n\t\t\t\t\t\t<option value=\"gift\">Gift</option>\n\t\t\t\t\t\t<option value=\"key\">Key</option>\n\t\t\t\t\t\t<option value=\"globe\">Website</option>\n\t\t\t\t\t\t<option value=\"bolt\">Bolt</option>\n\t\t\t\t\t\t<option value=\"diamond\">Diamond</option>\n\t\t\t\t\t\t<option value=\"bookmark-o\">Bookmark O</option>\n\t\t\t\t\t\t<option value=\"bookmark\">Bookmark</option>\t\n\t\t\t\t\t\t<option value=\"heart\">Heart</option>\n\t\t\t\t\t\t<option value=\"star\">Star</option>\n\t\t\t\t\t\t<option value=\"music\">Music</option>\n\t\t\t\t\t\t<option value=\"play\">Play</option>\n\t\t\t\t\t\t<option value=\"venus\">Venus</option>\n\t\t\t\t\t\t<option value=\"mars\">Mars</option>\n\t\t\t\t\t\t<option value=\"cogs\">Settings</option>\n\t\t\t\t\t\t<option value=\"gamepad\">Gamepad</option>\n\t\t\t\t\t\t<option value=\"cubes\">Cubes</option>\n\t\t\t\t\t\t<option value=\"undo\">Undo</option>\n\t\t\t\t\t\t<option value=\"circle-o\">Circle</option>\n\t\t\t\t\t\t<option value=\"info-circle\">İnfo Circle</option>\n\t\t\t\t\t</select>\n              </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Kişiye Özel Kategori</label>\n              <select class=\"form-control\" name=\"secret\">\n                    <option value=\"2\">Hayır</option>\n                    <option value=\"1\">Evet</option>\n                </select>\n            </div>\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Kategoriyi oluştur</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                        echo json_encode(["content" => $return, "title" => "Yeni kategori oluştur"]);
                                                    } else {
                                                        if ($action == "edit_category") {
                                                            $id = $_POST["id"];
                                                            $category = $conn->prepare("SELECT * FROM categories WHERE category_id=:id ");
                                                            $category->execute(["id" => $id]);
                                                            $category = $category->fetch(PDO::FETCH_ASSOC);
                                                            $return = "<form class=\"form\" action=\"" . site_url("admin/services/edit-category/" . $id) . "\" method=\"post\" data-xhr=\"true\">\n\n        <div class=\"modal-body\">\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Kategori adı</label>\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $category["category_name"] . "\">\n          </div>\n <div class=\"form-group\">\n\t\t\t\t<label class=\"form-group__service-name\">İcon <i id=\"icon\" class=\"fa fa-" . $category["category_icon"] . "\"></i></label>\n\t\t\t\t  <select class=\"form-control\" name=\"icon\">\n\t\t\t\t\t\t<option value=\"" . $category["category_icon"] . "\">Seçili : " . $category["category_icon"] . "</option>\n\t\t\t\t\t\t<option value=\"\">Yok</option>\n\t\t\t\t\t\t<option value=\"facebook-square\">Facebook</option>\n\t\t\t\t\t\t<option value=\"instagram\">Instagram</option>\n\t\t\t\t\t\t<option value=\"twitter\">Twitter</option>\n\t\t\t\t\t\t<option value=\"twitch\">Twitch</option>\n\t\t\t\t\t\t<option value=\"youtube-play\">Youtube</option>\n\t\t\t\t\t\t<option value=\"snapchat\">Snapchat</option>\n\t\t\t\t\t\t<option value=\"linkedin-square\">Linkedin</option>\n\t\t\t\t\t\t<option value=\"telegram\">Telegram</option>\n\t\t\t\t\t\t<option value=\"spotify\">Spotify</option>\n\t\t\t\t\t\t<option value=\"soundcloud\">Soundcloud</option>\n\t\t\t\t\t\t<option value=\"pinterest\">Pinterest</option>\n\t\t\t\t\t\t<option value=\"google\">Google</option>\n\t\t\t\t\t\t<option value=\"google-plus-official\">Google+</option>\n\t\t\t\t\t\t<option value=\"vk\">VK</option>\n\t\t\t\t\t\t<option value=\"thumbs-up\">Like</option>\n\t\t\t\t\t\t<option value=\"thumbs-down\">Dislike</option>\n\t\t\t\t\t\t<option value=\"user-plus\">Follower</option>\n\t\t\t\t\t\t<option value=\"comment\">Comment</option>\n\t\t\t\t\t\t<option value=\"align-justify\">Post</option>\n\t\t\t\t\t\t<option value=\"eye\">View</option>\n\t\t\t\t\t\t<option value=\"hashtag\">Hashtag</option>\n\t\t\t\t\t\t<option value=\"smile\">Smile</option>\n\t\t\t\t\t\t<option value=\"gift\">Gift</option>\n\t\t\t\t\t\t<option value=\"key\">Key</option>\n\t\t\t\t\t\t<option value=\"globe\">Website</option>\n\t\t\t\t\t\t<option value=\"bolt\">Bolt</option>\n\t\t\t\t\t\t<option value=\"diamond\">Diamond</option>\n\t\t\t\t\t\t<option value=\"bookmark-o\">Bookmark O</option>\n\t\t\t\t\t\t<option value=\"bookmark\">Bookmark</option>\t\n\t\t\t\t\t\t<option value=\"heart\">Heart</option>\n\t\t\t\t\t\t<option value=\"star\">Star</option>\n\t\t\t\t\t\t<option value=\"music\">Music</option>\n\t\t\t\t\t\t<option value=\"play\">Play</option>\n\t\t\t\t\t\t<option value=\"venus\">Venus</option>\n\t\t\t\t\t\t<option value=\"mars\">Mars</option>\n\t\t\t\t\t\t<option value=\"cogs\">Settings</option>\n\t\t\t\t\t\t<option value=\"gamepad\">Gamepad</option>\n\t\t\t\t\t\t<option value=\"cubes\">Cubes</option>\n\t\t\t\t\t\t<option value=\"undo\">Undo</option>\n\t\t\t\t\t\t<option value=\"circle-o\">Circle</option>\n\t\t\t\t\t\t<option value=\"info-circle\">İnfo Circle</option>\n\t\t\t\t\t</select>\n              </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Kişiye Özel Kategori</label>\n              <select class=\"form-control\" name=\"secret\">\n                    <option value=\"2\"";
                                                            if ($category["category_secret"] == 2) {
                                                                $return .= "selected";
                                                            }
                                                            $return .= ">Hayır</option>\n                    <option value=\"1\"";
                                                            if ($category["category_secret"] == 1) {
                                                                $return .= "selected";
                                                            }
                                                            $return .= ">Evet</option>\n                </select>\n            </div>\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Kategoriyi güncelle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                            echo json_encode(["content" => $return, "title" => "Kategoriyi düzenle (ID: " . $id . ")"]);
                                                        } else {
                                                            if ($action == "import_services") {
                                                                $providers = $conn->prepare("SELECT * FROM service_api");
                                                                $providers->execute([]);
                                                                $providers = $providers->fetchAll(PDO::FETCH_ASSOC);
                                                                $category = $conn->prepare("SELECT * FROM categories");
                                                                $category->execute([]);
                                                                $category = $category->fetchAll(PDO::FETCH_ASSOC);
                                                                $return = "<form class=\"form\" action=\"" . site_url("admin/services/get_services_add/") . "\" method=\"post\" data-xhr=\"true\">\n    \n        <div class=\"modal-body\">\n\n          <div id=\"firstStep\"><p style=\"font-size:12px;margin:0 0 15px 0\" id=\"get_services_warning\">\n        <b>DİKKAT</b> <br>\n        {$this}-> Ekleyeceğiniz servisler için dripfeed özelliği ve servis açıklaması çekilmeyecektir. <br>\n        {$this}-> Otomatik beğeni vb. servisleri buradan çektiğinizde çekmeyecektir Sadece normal servisleri çekebilirsiniz.  <br>\n        </p>\n        <hr>\n            <div class=\"service-mode__block\">\n              <div class=\"form-group\">\n              <label>Servis Sağlayıcısı</label>\n                <select class=\"form-control\" name=\"provider\" id=\"provider\">\n                      <option value=\"0\">Servis sağlayıcı seçiniz...</option>";
                                                                foreach ($providers as $provider) {
                                                                    $return .= "<option value=\"" . $provider["id"] . "\">" . $provider["api_name"] . "</option>";
                                                                }
                                                                $return .= "</select>\n              </div>\n            </div><div class=\"service-mode__block\">\n              <div class=\"form-group\">\n              <label>Servislerin Ekleneceği  Kategoriyi Seçiniz</label>\n                <select class=\"form-control\" name=\"selector\" id=\"selector\">\n                      <option value=\"0\">Kategori seçiniz...</option>";
                                                                foreach ($category as $cat) {
                                                                    $return .= "<option value=\"" . $cat["category_id"] . "\">" . $cat["category_name"] . "</option>";
                                                                }
                                                                $return .= "</select>\n              </div>\n            </div>\n          </div>\n\n          \n          <div id=\"secondStep\">\n          </div>\n\n          <div id=\"thirdStep\">\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n            <button type=\"button\" class=\"btn btn-primary\" id=\"nextStep\" data-step=\"first\">Sonra ki adım</button>\n            <button type=\"submit\" class=\"btn btn-primary\" id=\"submitStep\">Servisleri ekle</button>\n          </div>\n\n        </form>\n           <script>\n            \$(\"#submitStep\").hide();\n            \$(\"#nextStep\").click(function(){\n              var now_step = \$(this).attr(\"data-step\");\n              var provider = \$(\"#provider\").val();\n              var category = \$(\"#selector\").val();\n              \$(\"#secondStep\").hide();\n                if( now_step == \"first\" ){\n                  if( provider == 0 ){\n                    \$.toast({\n                        heading: \"Başarısız\",\n                        text: \"Lütfen servis sağlayıcısını seçin\",\n                        icon: \"error\",\n                        loader: true,\n                        loaderBg: \"#9EC600\"\n                    });\n                  }else{\n                    \$(\"#firstStep\").hide();\n                    \$(\"#secondStep\").show();\n                    \$.post(\"admin/ajax_data\", {provider:provider,category:category,action:\"import_services_list\" }, function(data){\n                      \$(\"#secondStep\").html(data);\n                    });\n                    \$(\"#nextStep\").attr(\"data-step\",\"second\");\n                  }\n                }else if( now_step == \"second\" ){\n                    var array     = [];\n                       \$('[class^=\"selectServices-\"]').each(function () {\n                            var id    = \$(this).val();\n                            var check = \$(this).prop(\"checked\");\n                            var provider  =  \$(this).attr(\"data-provider\");\n                              if( check == true ){\n                                var params = {};\n                                params[\"id\"]            = id;\n                                params[\"category\"]      = \$(this).attr(\"data-category\");\n                                array.push(params);\n                              }\n                       });\n                       var count = array.length;\n                     if( count ){\n                       \$.post(\"admin/ajax_data\", {provider:provider,action:\"import_services_last\",services:array }, function(data){\n                         \$(\"#thirdStep\").html(data);\n                       });\n                       \$(\"#nextStep\").hide();\n                       \$(\"#submitStep\").show();\n                     }else{\n                       \$(\"#nextStep\").attr(\"data-step\",\"second\");\n                       \$(\"#firstStep\").hide();\n                       \$(\"#secondStep\").show();\n                       \$(\"#nextStep\").show();\n                       \$(\"#submitStep\").hide();\n                       \$.toast({\n                           heading: \"Başarısız\",\n                           text: \"Lütfen eklemek istediğiniz en az 1 servisi seçin\",\n                           icon: \"error\",\n                           loader: true,\n                           loaderBg: \"#9EC600\"\n                       });\n                     }\n\n                }\n            });\n          </script>\n          ";
                                                                echo json_encode(["content" => $return, "title" => "Sağlayıcıdaki servisleri çek"]);
                                                            } else {
                                                                if ($action == "import_services_list") {
                                                                    $provider_id = $_POST["provider"];
                                                                    $category_id2 = $_POST["category"];
                                                                    $smmapi = new SMMApi();
                                                                    $provider = $conn->prepare("SELECT * FROM service_api WHERE id=:id");
                                                                    $provider->execute(["id" => $provider_id]);
                                                                    $provider = $provider->fetch(PDO::FETCH_ASSOC);
                                                                    if ($provider["api_type"] == 1) {
                                                                        $services = $smmapi->action(["key" => $provider["api_key"], "action" => "services"], $provider["api_url"]);
                                                                        if ($services) {
                                                                            $grouped = array_group_by($services, "category");
                                                                            echo "<div class=\"\">\n            <div class=\"services-import__body\">\n                 <div>\n                    <div class=\"services-import__list-wrap\">\n                       <div class=\"services-import__scroll-wrap\">";
                                                                            foreach ($grouped as $category) {
                                                                                $category_id++;
                                                                                echo "\n                          <span>\n                             <div class=\"services-import__category\">\n                                <div class=\"services-import__category-title\">\n                                  <label><input type=\"checkbox\" data-id=\"" . $category_id . "\" id=\"checkAll-" . $category_id . "\">" . $category[0]->category . "</label>\n                                                                <input type=\"hidden\" name=\"category\" value=\"" . $category_id2 . "\">\n                                </div>\n                             </div>\n                             <div class=\"services-import__packages\">\n                                <ul>";
                                                                                for ($i = 0; $i < count($category); $i++) {
                                                                                    echo "<li><label><input data-service=\"" . $category[$i]->name . "\" data-provider=\"" . $provider["id"] . "\"  data-category=\"" . $category_id . "\"  class=\"selectServices-" . $category_id . "\" type=\"checkbox\" value=\"" . $category[$i]->service . "\" name=\"services[]\">" . $category[$i]->service . " - " . $category[$i]->name . "<span class=\"services-import__packages-price\">" . priceFormat($category[$i]->rate) . "</span></label></li>";
                                                                                }
                                                                                echo "</ul>\n                             </div>\n                          </span>";
                                                                            }
                                                                            echo "\n                       </div>\n                    </div>\n                 </div>\n              </div>\n              <script>\n              \$('[id^=\"checkAll-\"]').click(function () {\n                var id = \$(this).attr(\"data-id\");\n                 if ( \$(this).prop(\"checked\") == true ) {\n                   \$(\".selectServices-\"+id).not(this).prop(\"checked\", true);\n                 }else{\n                   \$(\".selectServices-\"+id).not(this).prop(\"checked\", false);\n                 }\n               });\n              </script>\n              </div>";
                                                                        } else {
                                                                            echo "Hata oluştu, lütfen daha sonra deneyin.";
                                                                        }
                                                                    }
                                                                } else {
                                                                    if ($action == "import_services_last") {
                                                                        $provider_id = $_POST["provider"];
                                                                        $services = json_decode(json_encode($_POST["services"]));
                                                                        $smmapi = new SMMApi();
                                                                        $provider = $conn->prepare("SELECT * FROM service_api WHERE id=:id");
                                                                        $provider->execute(["id" => $provider_id]);
                                                                        $provider = $provider->fetch(PDO::FETCH_ASSOC);
                                                                        $apiServices = $smmapi->action(["key" => $provider["api_key"], "action" => "services"], $provider["api_url"]);
                                                                        $grouped = array_group_by($services, "category");
                                                                        echo "\n      <div class=\"services-import__body\">\n             <div>\n                <div class=\"services-import__fields\">\n                   <div class=\"services-import__step3-field\">\n                      <div class=\"services-import__placeholder-title\">Sabit (1.00)</div>\n                      <input type=\"number\" placeholder=\"0\" id=\"raise-fixed\" name=\"fixed\" value=\"\">\n                   </div>\n                   <div class=\"services-import__step3-plus\">+</div>\n                   <div class=\"services-import__step3-field\">\n                      <div class=\"services-import__placeholder-title\">Yüzde (%)</div>\n                      <input type=\"number\" placeholder=\"0\" id=\"raise-percent\" name=\"percent\" value=\"\">\n                   </div>\n                   <div class=\"services-import__step3-actions\"><span class=\"btn btn-default\">Hesaplamaları sıfırla</span></div>\n                </div>\n                <div class=\"services-import__list-wrap services-import__list-active\">\n                   <div class=\"services-import__scroll-wrap\">";
                                                                        $category_id = 0;
                                                                        $c = 0;
                                                                        foreach ($grouped as $category) {
                                                                            foreach ($apiServices as $key => $value) {
                                                                                if ($category[$category_id]->id == $value->service) {
                                                                                    $categoryName = $value->category;
                                                                                }
                                                                            }
                                                                            $category_id = $category_id++;
                                                                            $c++;
                                                                            echo "<span class=\"providerCategory\" id=\"providerCategory-" . $c . "\">\n                           <div class=\"services-import__category\">\n                              <div class=\"services-import__category-title\"><label>" . $categoryName . "</label></div>\n                           </div>\n                           <div class=\"services-import__packages\">\n                              <ul>";
                                                                            for ($i = 0; $i < count($category); $i++) {
                                                                                foreach ($apiServices as $apiService) {
                                                                                    if ($apiService->service == $category[$i]->id) {
                                                                                        echo "<li id=\"providerService-" . $apiService->service . "\">\n                                         <label>\n                                            " . $apiService->service . " - " . $apiService->name . "\n                                            <span class=\"services-import__packages-price-edit\" >\n                                               <div class=\"services-import__packages-price-lock\" data-category=\"" . $c . "\"  data-id=\"servicedelete-" . $apiService->service . "\" data-service=\"" . $apiService->service . "\">\n                                                 <span class=\"fa fa-trash\"></span>\n                                               </div>\n                                               <div class=\"services-import__packages-price-lock\"  data-id=\"servicelock-" . $apiService->service . "\" data-service=\"" . $apiService->service . "\">\n                                                 <span class=\"fa fa-unlock\"></span>\n                                               </div>\n                                               <input id=\"servicePriceCal" . $apiService->service . "\" type=\"text\" class=\"services-import__price\" data-rate=\"" . priceFormat($apiService->rate) . "\" data-service=\"" . $apiService->service . "\" name=\"servicesList[" . $apiService->service . "]\" value=\"" . priceFormat($apiService->rate) . "\">\n                                               <span class=\"services-import__provider-price\">" . priceFormat($apiService->rate) . "</span>\n                                            </span>\n                                         </label>\n                                      </li>";
                                                                                    }
                                                                                }
                                                                            }
                                                                            echo "</ul>\n                           </div>\n                        </span>";
                                                                        }
                                                                        echo "</div>\n                </div>\n             </div>\n          </div>\n          <script>\n          function formatCurrency(total) {\n              var neg = false;\n              if(total < 0) {\n                  neg = true;\n                  total = Math.abs(total);\n              }\n              return parseFloat(total, 10).toFixed(2).replace(/(\\d)(?=(\\d{3})+\\.)/g, \"\$1,\").toString();\n          }\n          function sum(input){\n           if (toString.call(input) !== \"[object Array]\")\n              return false;\n\n                      var total =  0;\n                      for(var i=0;i<input.length;i++)\n                        {\n                          if(isNaN(input[i])){\n                          continue;\n                           }\n                      total += Number(input[i]);\n                   }\n             return total;\n            }\n          function chargeService(){\n            var add_fixed       = \$(\"#raise-fixed\").val();\n            var add_percent     = \$(\"#raise-percent\").val();\n            \$(\".services-import__price\").each(function(){\n              if( \$(this).attr(\"readonly\") != \"readonly\" ){\n                var rate        = \$(this).attr(\"data-rate\");\n                var service     = \$(this).attr(\"data-service\");\n                var total = sum([rate,(rate*add_percent/100),add_fixed]);\n                \$(\"#servicePriceCal\"+service).val(total);\n\n              }\n            });\n          }\n            \$('[data-id^=\"servicedelete-\"]').click(function(){\n              var id        = \$(this).attr(\"data-service\");\n              var category  = \$(this).attr(\"data-category\");\n              \$(\"li#providerService-\"+id).remove();\n                if( \$(\"#providerCategory-\"+category+\" > .services-import__packages > ul > li\").length == 0 ){\n                  \$(\"#providerCategory-\"+category).remove();\n                }\n            });\n            \$('[data-id^=\"servicelock-\"]').click(function(){\n              var service_id  = \$(this).attr(\"data-service\");\n              var lock        = \$(this).find(\"span\").attr(\"class\");\n              if( lock == \"fa fa-unlock\" ){\n                \$(this).find(\"span\").removeClass(\"fa fa-unlock\");\n                \$(this).find(\"span\").addClass(\"fa fa-lock\");\n                \$('[data-service=\"'+service_id+'\"]').attr(\"readonly\",true);\n              } else{\n                \$(this).find(\"span\").removeClass(\"fa fa-lock\");\n                \$(this).find(\"span\").addClass(\"fa fa-unlock\");\n                \$('[data-service=\"'+service_id+'\"]').attr(\"readonly\",false);\n              }\n            });\n\n            \$(\".services-import__step3-actions\").click(function(){\n              var add_fixed       = \$(\"#raise-fixed\").val(\"\");\n              var add_percent     = \$(\"#raise-percent\").val(\"\");\n              \$(\".services-import__price\").each(function(){\n                if( \$(this).attr(\"readonly\") != \"readonly\" ){\n                  var rate        = \$(this).attr(\"data-rate\");\n                  var service     = \$(this).attr(\"data-service\");\n                    \$(\"#servicePriceCal\"+service).val(rate);\n                }\n              });\n            });\n\n            \$(\"#raise-fixed\").on(\"keyup\", function(){\n              chargeService();\n            });\n\n            \$(\"#raise-percent\").on(\"keyup\", function(){\n              chargeService();\n            });\n\n          </script>\n          ";
                                                                    } else {
                                                                        if ($action == "price_providerCal") {
                                                                            $fixed = $_POST["fixed"];
                                                                            $percent = $_POST["percent"];
                                                                            $rate = $_POST["rate"];
                                                                            $total = $rate;
                                                                            if (is_numeric($percent) && 0 < $percent) {
                                                                                $total = $total + $rate * $percent / 100;
                                                                            }
                                                                            if (is_numeric($fixed) && 0 < $fixed) {
                                                                                $total = $total + $fixed;
                                                                            }
                                                                            echo $total;
                                                                        } else {
                                                                            if ($action == "new_ticket") {
                                                                                $return = "<form class=\"form\" action=\"" . site_url("admin/tickets/new") . "\" method=\"post\" data-xhr=\"true\">\n        <div class=\"modal-body\">\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Kullanıcı adı</label>\n            <input type=\"text\" class=\"form-control\" name=\"username\" value=\"\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Konu</label>\n            <input type=\"text\" class=\"form-control\" name=\"subject\" value=\"\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Mesajınız</label>\n            <textarea class=\"form-control\" name=\"message\" rows=\"4\"></textarea>\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Yeni talebi oluştur</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                echo json_encode(["content" => $return, "title" => "Yeni destek talebi"]);
                                                                            } else {
                                                                                if ($action == "yeni_kupon") {
                                                                                    $return = "<form class=\"form\" action=\"" . site_url("admin/kuponlar/new") . "\" method=\"post\" data-xhr=\"true\">\n        <div class=\"modal-body\">\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Kupon Kodu</label>\n            <input type=\"text\" class=\"form-control\" name=\"kuponadi\" value=\"\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Adet</label>\n            <input type=\"text\" class=\"form-control\" name=\"adet\" value=\"\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Tutar</label>\n            <input type=\"text\" class=\"form-control\" name=\"tutar\" value=\"\">\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Yeni kupon oluştur</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>\n          ";
                                                                                    echo json_encode(["content" => $return, "title" => "Yeni kupon oluştur"]);
                                                                                } else {
                                                                                    if ($action == "edit_paymentmethod" && $_POST["id"] == "paytr") {
                                                                                        $id = $_POST["id"];
                                                                                        $method = $conn->prepare("SELECT * FROM payment_methods WHERE method_get=:id ");
                                                                                        $method->execute(["id" => $id]);
                                                                                        $method = $method->fetch(PDO::FETCH_ASSOC);
                                                                                        $extra = json_decode($method["method_extras"], true);
                                                                                        $return = "<form class=\"form\" action=\"" . site_url("admin/settings/payment-methods/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\n\n        <div class=\"modal-body\">\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Method adı</label>\n            <input type=\"text\" class=\"form-control\" readonly value=\"" . $method["method_name"] . "\">\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Görünürlük</label>\n              <select class=\"form-control\" name=\"method_type\">\n                    <option value=\"2\"";
                                                                                        if ($method["method_type"] == 2) {
                                                                                            $return .= "selected";
                                                                                        }
                                                                                        $return .= ">Aktif</option>\n                    <option value=\"1\"";
                                                                                        if ($method["method_type"] == 1) {
                                                                                            $return .= "selected";
                                                                                        }
                                                                                        $return .= ">Pasif</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Görünür adı</label>\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $extra["name"] . "\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Minimum Ödeme</label>\n            <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $extra["min"] . "\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Maksimum Ödeme</label>\n            <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $extra["max"] . "\">\n          </div>\n\n          <hr>\n            <p class=\"card-description\">\n              <ul>\n                <li>\n                  API Geri Dönüş Adresi: <code>";
                                                                                        $return .= site_url("payment/" . $method["method_get"]);
                                                                                        $return .= "</code>\n                </li>\n              </ul>\n            </p>\n          <hr>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Merchant id</label>\n            <input type=\"text\" class=\"form-control\" name=\"merchant_id\" value=\"" . $extra["merchant_id"] . "\">\n          </div>\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Merchant key</label>\n            <input type=\"text\" class=\"form-control\" name=\"merchant_key\" value=\"" . $extra["merchant_key"] . "\">\n          </div>\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Merchant salt</label>\n            <input type=\"text\" class=\"form-control\" name=\"merchant_salt\" value=\"" . $extra["merchant_salt"] . "\">\n          </div>\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Komisyon, %</label>\n            <input type=\"text\" class=\"form-control\" name=\"fee\" value=\"" . $extra["fee"] . "\">\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                        echo json_encode(["content" => $return, "title" => "Ödeme methodu düzenle (Method: " . $method["method_name"] . ")"]);
                                                                                    } else {
                                                                                        if ($action == "edit_paymentmethod" && $_POST["id"] == "paytr_havale") {
                                                                                            $id = $_POST["id"];
                                                                                            $method = $conn->prepare("SELECT * FROM payment_methods WHERE method_get=:id ");
                                                                                            $method->execute(["id" => $id]);
                                                                                            $method = $method->fetch(PDO::FETCH_ASSOC);
                                                                                            $extra = json_decode($method["method_extras"], true);
                                                                                            $return = "<form class=\"form\" action=\"" . site_url("admin/settings/payment-methods/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\n\n        <div class=\"modal-body\">\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Method adı</label>\n            <input type=\"text\" class=\"form-control\" readonly value=\"" . $method["method_name"] . "\">\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Görünürlük</label>\n              <select class=\"form-control\" name=\"method_type\">\n                    <option value=\"2\"";
                                                                                            if ($method["method_type"] == 2) {
                                                                                                $return .= "selected";
                                                                                            }
                                                                                            $return .= ">Aktif</option>\n                    <option value=\"1\"";
                                                                                            if ($method["method_type"] == 1) {
                                                                                                $return .= "selected";
                                                                                            }
                                                                                            $return .= ">Pasif</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Görünür adı</label>\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $extra["name"] . "\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Minimum Ödeme</label>\n            <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $extra["min"] . "\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Maksimum Ödeme</label>\n            <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $extra["max"] . "\">\n          </div>\n\n          <hr>\n            <p class=\"card-description\">\n              <ul>\n                <li>\n                  API Geri Dönüş Adresi: <code>";
                                                                                            $return .= site_url("payment/paytr");
                                                                                            $return .= "</code>\n                </li>\n              </ul>\n            </p>\n          <hr>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Merchant id</label>\n            <input type=\"text\" class=\"form-control\" name=\"merchant_id\" value=\"" . $extra["merchant_id"] . "\">\n          </div>\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Merchant key</label>\n            <input type=\"text\" class=\"form-control\" name=\"merchant_key\" value=\"" . $extra["merchant_key"] . "\">\n          </div>\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Merchant salt</label>\n            <input type=\"text\" class=\"form-control\" name=\"merchant_salt\" value=\"" . $extra["merchant_salt"] . "\">\n          </div>\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Komisyon, %</label>\n            <input type=\"text\" class=\"form-control\" name=\"fee\" value=\"" . $extra["fee"] . "\">\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                            echo json_encode(["content" => $return, "title" => "Ödeme methodu düzenle (Method: " . $method["method_name"] . ")"]);
                                                                                        } else {
                                                                                            if ($action == "edit_paymentmethod" && $_POST["id"] == "paywant") {
                                                                                                $id = $_POST["id"];
                                                                                                $method = $conn->prepare("SELECT * FROM payment_methods WHERE method_get=:id ");
                                                                                                $method->execute(["id" => $id]);
                                                                                                $method = $method->fetch(PDO::FETCH_ASSOC);
                                                                                                $extra = json_decode($method["method_extras"], true);
                                                                                                $return = "<form class=\"form\" action=\"" . site_url("admin/settings/payment-methods/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\n\n        <div class=\"modal-body\">\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Method adı</label>\n            <input type=\"text\" class=\"form-control\" readonly value=\"" . $method["method_name"] . "\">\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Görünürlük</label>\n              <select class=\"form-control\" name=\"method_type\">\n                    <option value=\"2\"";
                                                                                                if ($method["method_type"] == 2) {
                                                                                                    $return .= "selected";
                                                                                                }
                                                                                                $return .= ">Aktif</option>\n                    <option value=\"1\"";
                                                                                                if ($method["method_type"] == 1) {
                                                                                                    $return .= "selected";
                                                                                                }
                                                                                                $return .= ">Pasif</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Görünür adı</label>\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $extra["name"] . "\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Minimum Ödeme</label>\n            <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $extra["min"] . "\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Maksimum Ödeme</label>\n            <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $extra["max"] . "\">\n          </div>\n\n          <hr>\n            <p class=\"card-description\">\n              <ul>\n                <li>\n                  API Geri Dönüş Adresi: <code>";
                                                                                                $return .= site_url("payment/" . $method["method_get"]);
                                                                                                $return .= "</code>\n                </li>\n              </ul>\n            </p>\n          <hr>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">apiKey</label>\n            <input type=\"text\" class=\"form-control\" name=\"apiKey\" value=\"" . $extra["apiKey"] . "\">\n          </div>\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">apiSecret</label>\n            <input type=\"text\" class=\"form-control\" name=\"apiSecret\" value=\"" . $extra["apiSecret"] . "\">\n          </div>\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Komisyon, %</label>\n            <input type=\"text\" class=\"form-control\" name=\"fee\" value=\"" . $extra["fee"] . "\">\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Paywant Komison</label>\n              <select class=\"form-control\" name=\"commissionType\">\n                    <option value=\"2\"";
                                                                                                if ($extra["commissionType"] == 2) {
                                                                                                    $return .= "selected";
                                                                                                }
                                                                                                $return .= ">Kullanıcıya yansıt</option>\n                    <option value=\"1\"";
                                                                                                if ($extra["commissionType"] == 1) {
                                                                                                    $return .= "selected";
                                                                                                }
                                                                                                $return .= ">Kullanıcıya yansıtma</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"form-group\">\n            <label>Ödeme Yöntemleri</label>\n              <div class=\"form-group col-md-12\">\n                  <div class=\"row\">\n                    <label class=\"checkbox-inline col-md-3\">\n                      <input type=\"checkbox\" class=\"access\" name=\"payment_type[]\" value=\"1\"";
                                                                                                if (in_array(1, $extra["payment_type"])) {
                                                                                                    $return .= " checked";
                                                                                                }
                                                                                                $return .= "> Mobil Ödeme\n                    </label>\n                    <label class=\"checkbox-inline col-md-3\">\n                      <input type=\"checkbox\" class=\"access\" name=\"payment_type[]\" value=\"2\"";
                                                                                                if (in_array(2, $extra["payment_type"])) {
                                                                                                    $return .= " checked";
                                                                                                }
                                                                                                $return .= "> Kredi/Banka Kartı\n                    </label>\n                    <label class=\"checkbox-inline col-md-3\">\n                      <input type=\"checkbox\" class=\"access\" name=\"payment_type[]\" value=\"3\"";
                                                                                                if (in_array(3, $extra["payment_type"])) {
                                                                                                    $return .= " checked";
                                                                                                }
                                                                                                $return .= "> Havale/EFT\n                    </label>\n                  </div>\n              </div>\n            </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                echo json_encode(["content" => $return, "title" => "Ödeme methodu düzenle (Method: " . $method["method_name"] . ")"]);
                                                                                            } else {
                                                                                                if ($action == "edit_paymentmethod" && $_POST["id"] == "buypayer") {
                                                                                                    $id = $_POST["id"];
                                                                                                    $method = $conn->prepare("SELECT * FROM payment_methods WHERE method_get=:id ");
                                                                                                    $method->execute(["id" => $id]);
                                                                                                    $method = $method->fetch(PDO::FETCH_ASSOC);
                                                                                                    $extra = json_decode($method["method_extras"], true);
                                                                                                    $return = "<form class=\"form\" action=\"" . site_url("admin/settings/payment-methods/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\n\n        <div class=\"modal-body\">\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Method adı</label>\n            <input type=\"text\" class=\"form-control\" readonly value=\"" . $method["method_name"] . "\">\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Görünürlük</label>\n              <select class=\"form-control\" name=\"method_type\">\n                    <option value=\"2\"";
                                                                                                    if ($method["method_type"] == 2) {
                                                                                                        $return .= "selected";
                                                                                                    }
                                                                                                    $return .= ">Aktif</option>\n                    <option value=\"1\"";
                                                                                                    if ($method["method_type"] == 1) {
                                                                                                        $return .= "selected";
                                                                                                    }
                                                                                                    $return .= ">Pasif</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Görünür adı</label>\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $extra["name"] . "\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Minimum Ödeme</label>\n            <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $extra["min"] . "\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Maksimum Ödeme</label>\n            <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $extra["max"] . "\">\n          </div>\n\n          <hr>\n            <p class=\"card-description\">\n              <ul>\n                <li>\n                  API Geri Dönüş Adresi: <code>";
                                                                                                    $return .= site_url("payment/" . $method["method_get"]);
                                                                                                    $return .= "</code>\n                </li>\n              </ul>\n            </p>\n          <hr>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Mağaza No</label>\n            <input type=\"text\" class=\"form-control\" name=\"magaza_no\" value=\"" . $extra["magaza_no"] . "\">\n          </div>\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Mağaza Güvenlik Kodu</label>\n            <input type=\"text\" class=\"form-control\" name=\"magaza_secret\" value=\"" . $extra["magaza_secret"] . "\">\n          </div>\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Mağaza Mail Adresi</label>\n            <input type=\"text\" class=\"form-control\" name=\"magaza_mail\" value=\"" . $extra["magaza_mail"] . "\">\n          </div>\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Komisyon, %</label>\n            <input type=\"text\" class=\"form-control\" name=\"fee\" value=\"" . $extra["fee"] . "\">\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                    echo json_encode(["content" => $return, "title" => "Ödeme methodu düzenle (Method: " . $method["method_name"] . ")"]);
                                                                                                } else {
                                                                                                    if ($action == "edit_paymentmethod" && $_POST["id"] == "shopier") {
                                                                                                        $id = $_POST["id"];
                                                                                                        $method = $conn->prepare("SELECT * FROM payment_methods WHERE method_get=:id ");
                                                                                                        $method->execute(["id" => $id]);
                                                                                                        $method = $method->fetch(PDO::FETCH_ASSOC);
                                                                                                        $extra = json_decode($method["method_extras"], true);
                                                                                                        $return = "<form class=\"form\" action=\"" . site_url("admin/settings/payment-methods/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\n\n        <div class=\"modal-body\">\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Method adı</label>\n            <input type=\"text\" class=\"form-control\" readonly value=\"" . $method["method_name"] . "\">\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Görünürlük</label>\n              <select class=\"form-control\" name=\"method_type\">\n                    <option value=\"2\"";
                                                                                                        if ($method["method_type"] == 2) {
                                                                                                            $return .= "selected";
                                                                                                        }
                                                                                                        $return .= ">Aktif</option>\n                    <option value=\"1\"";
                                                                                                        if ($method["method_type"] == 1) {
                                                                                                            $return .= "selected";
                                                                                                        }
                                                                                                        $return .= ">Pasif</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Görünür adı</label>\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $extra["name"] . "\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Minimum Ödeme</label>\n            <input type=\"text\" class=\"form-control\" name=\"min\" value=\"" . $extra["min"] . "\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Maksimum Ödeme</label>\n            <input type=\"text\" class=\"form-control\" name=\"max\" value=\"" . $extra["max"] . "\">\n          </div>\n\n          <hr>\n            <p class=\"card-description\">\n              <ul>\n                <li>\n                  API Geri Dönüş Adresi: <code>";
                                                                                                        $return .= site_url("payment/" . $method["method_get"]);
                                                                                                        $return .= "</code>\n                </li>\n              </ul>\n            </p>\n          <hr>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">apiKey</label>\n            <input type=\"text\" class=\"form-control\" name=\"apiKey\" value=\"" . $extra["apiKey"] . "\">\n          </div>\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">apiSecret</label>\n            <input type=\"text\" class=\"form-control\" name=\"apiSecret\" value=\"" . $extra["apiSecret"] . "\">\n          </div>\n          <div class=\"form-group\">\n          <label>Geri dönüş</label>\n            <select class=\"form-control\" name=\"website_index\">\n                  <option value=\"1\"";
                                                                                                        if ($extra["website_index"] == 1) {
                                                                                                            $return .= "selected";
                                                                                                        }
                                                                                                        $return .= ">Geri dönüş URL (1)</option>\n                  <option value=\"2\"";
                                                                                                        if ($extra["website_index"] == 2) {
                                                                                                            $return .= "selected";
                                                                                                        }
                                                                                                        $return .= ">Geri dönüş URL (2)</option>\n                  <option value=\"3\"";
                                                                                                        if ($extra["website_index"] == 3) {
                                                                                                            $return .= "selected";
                                                                                                        }
                                                                                                        $return .= ">Geri dönüş URL (3)</option>\n                  <option value=\"4\"";
                                                                                                        if ($extra["website_index"] == 4) {
                                                                                                            $return .= "selected";
                                                                                                        }
                                                                                                        $return .= ">Geri dönüş URL (4)</option>\n                  <option value=\"5\"";
                                                                                                        if ($extra["website_index"] == 5) {
                                                                                                            $return .= "selected";
                                                                                                        }
                                                                                                        $return .= ">Geri dönüş URL (5)</option>\n              </select>\n          </div>\n          <div class=\"form-group\">\n          <label>İşlem ücreti (0,49 TL)</label>\n            <select class=\"form-control\" name=\"processing_fee\">\n                  <option value=\"1\"";
                                                                                                        if ($extra["processing_fee"] == 1) {
                                                                                                            $return .= "selected";
                                                                                                        }
                                                                                                        $return .= ">Yansıt</option>\n                  <option value=\"0\"";
                                                                                                        if ($extra["processing_fee"] == 0) {
                                                                                                            $return .= "selected";
                                                                                                        }
                                                                                                        $return .= ">Yansıtma</option>\n              </select>\n          </div>\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Komisyon, %</label>\n            <input type=\"text\" class=\"form-control\" name=\"fee\" value=\"" . $extra["fee"] . "\">\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                        echo json_encode(["content" => $return, "title" => "Ödeme methodu düzenle (Method: " . $method["method_name"] . ")"]);
                                                                                                    } else {
                                                                                                        if ($action == "edit_paymentmethod" && $_POST["id"] == "havale-eft") {
                                                                                                            $id = $_POST["id"];
                                                                                                            $method = $conn->prepare("SELECT * FROM payment_methods WHERE method_get=:id ");
                                                                                                            $method->execute(["id" => $id]);
                                                                                                            $method = $method->fetch(PDO::FETCH_ASSOC);
                                                                                                            $extra = json_decode($method["method_extras"], true);
                                                                                                            $return = "<form class=\"form\" action=\"" . site_url("admin/settings/payment-methods/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\n\n        <div class=\"modal-body\">\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Method adı</label>\n            <input type=\"text\" class=\"form-control\" readonly value=\"" . $method["method_name"] . "\">\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Görünürlük</label>\n              <select class=\"form-control\" name=\"method_type\">\n                    <option value=\"2\"";
                                                                                                            if ($method["method_type"] == 2) {
                                                                                                                $return .= "selected";
                                                                                                            }
                                                                                                            $return .= ">Aktif</option>\n                    <option value=\"1\"";
                                                                                                            if ($method["method_type"] == 1) {
                                                                                                                $return .= "selected";
                                                                                                            }
                                                                                                            $return .= ">Pasif</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Görünür adı</label>\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $extra["name"] . "\">\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                            echo json_encode(["content" => $return, "title" => "Ödeme methodu düzenle (Method: " . $method["method_name"] . ")"]);
                                                                                                        } else {
                                                                                                            if ($action == "new_bankaccount") {
                                                                                                                $return = "<form class=\"form\" action=\"" . site_url("admin/settings/bank-accounts/new") . "\" method=\"post\" data-xhr=\"true\">\n        <div class=\"modal-body\">\n\n          <div class=\"form-group\">\n            <label class=\"form-group\">Banka adı</label>\n            <input type=\"text\" name=\"bank_name\" class=\"form-control\" value=\"\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group\">Alıcı adı</label>\n            <input type=\"text\" name=\"bank_alici\" class=\"form-control\" value=\"\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group\">Şube no</label>\n            <input type=\"text\" name=\"bank_sube\" class=\"form-control\" value=\"\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group\">Hesap no</label>\n            <input type=\"text\" name=\"bank_hesap\" class=\"form-control\" value=\"\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group\">IBAN</label>\n            <input type=\"text\" name=\"bank_iban\" class=\"form-control\" value=\"\">\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Yeni banka hesabını ekle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                                echo json_encode(["content" => $return, "title" => "Yeni banka hesabı"]);
                                                                                                            } else {
                                                                                                                if ($action == "edit_bankaccount") {
                                                                                                                    $id = $_POST["id"];
                                                                                                                    $bank = $conn->prepare("SELECT * FROM bank_accounts WHERE id=:id ");
                                                                                                                    $bank->execute(["id" => $id]);
                                                                                                                    $bank = $bank->fetch(PDO::FETCH_ASSOC);
                                                                                                                    $return = "<form class=\"form\" action=\"" . site_url("admin/settings/bank-accounts/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\n        <div class=\"modal-body\">\n\n          <div class=\"form-group\">\n            <label class=\"form-group\">Banka adı</label>\n            <input type=\"text\" name=\"bank_name\" class=\"form-control\" value=\"" . $bank["bank_name"] . "\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group\">Alıcı adı</label>\n            <input type=\"text\" name=\"bank_alici\" class=\"form-control\" value=\"" . $bank["bank_alici"] . "\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group\">Şube no</label>\n            <input type=\"text\" name=\"bank_sube\" class=\"form-control\" value=\"" . $bank["bank_sube"] . "\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group\">Hesap no</label>\n            <input type=\"text\" name=\"bank_hesap\" class=\"form-control\" value=\"" . $bank["bank_hesap"] . "\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group\">IBAN</label>\n            <input type=\"text\" name=\"bank_iban\" class=\"form-control\" value=\"" . $bank["bank_iban"] . "\">\n          </div>\n\n\n        </div>\n\n        <div class=\"modal-footer\">\n          <a id=\"delete-row\" data-url=\"" . site_url("admin/settings/bank-accounts/delete/" . $bank["id"]) . "\" class=\"btn btn-danger pull-left\">Hesabı kaldır</a>\n          <button type=\"submit\" class=\"btn btn-primary\">Banka hesabını güncelle</button>\n          <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n        </div>\n        </form>\n        <script src=\"https://unpkg.com/sweetalert/dist/sweetalert.min.js\"></script>\n        <script>\n        \$(\"#delete-row\").click(function(){\n          var action = \$(this).attr(\"data-url\");\n          swal({\n            title: \"Silmek istediğinizden emin misiniz?\",\n            text: \"Eğer onaylarsanız bu içerik silinecek, bunu geri getirmek mümkün olmayabilir.\",\n            icon: \"warning\",\n            buttons: true,\n            dangerMode: true,\n            buttons: [\"Vazgeç\", \"Evet, eminim!\"],\n          })\n          .then((willDelete) => {\n            if (willDelete) {\n              \$.ajax({\n                url:  action,\n                type: \"GET\",\n                dataType: \"json\",\n                cache: false,\n                contentType: false,\n                processData: false\n              })\n              .done(function(result){\n                if( result.s == \"error\" ){\n                  var heading = \"Başarısız\";\n                }else{\n                  var heading = \"Başarılı\";\n                }\n                  \$.toast({\n                      heading: heading,\n                      text: result.m,\n                      icon: result.s,\n                      loader: true,\n                      loaderBg: \"#9EC600\"\n                  });\n                  if (result.r!=null) {\n                    if( result.time ==null ){ result.time = 3; }\n                    setTimeout(function(){\n                      window.location.href  = result.r;\n                    },result.time*1000);\n                  }\n              })\n              .fail(function(){\n                \$.toast({\n                    heading: \"Başarısız\",\n                    text: \"İstek gerçekleştirilemedi\",\n                    icon: \"error\",\n                    loader: true,\n                    loaderBg: \"#9EC600\"\n                });\n              });\n              /* İçerik silinmesi onaylandı */\n            } else {\n              \$.toast({\n                  heading: \"Başarısız\",\n                  text: \"Silinme istediği reddedildi\",\n                  icon: \"error\",\n                  loader: true,\n                  loaderBg: \"#9EC600\"\n              });\n            }\n          });\n        });\n        </script>\n          </form>";
                                                                                                                    echo json_encode(["content" => $return, "title" => "Banka hesabını güncelle"]);
                                                                                                                } else {
                                                                                                                    if ($action == "new_paymentbonus") {
                                                                                                                        $methodList = $conn->prepare("SELECT * FROM payment_methods WHERE id!='4' ");
                                                                                                                        $methodList->execute([]);
                                                                                                                        $methodList = $methodList->fetchAll(PDO::FETCH_ASSOC);
                                                                                                                        $return = "<form class=\"form\" action=\"" . site_url("admin/settings/payment-bonuses/new") . "\" method=\"post\" data-xhr=\"true\">\n        <div class=\"modal-body\">\n\n          <div class=\"form-group\">\n          <label>Method</label>\n            <select class=\"form-control\" name=\"method_type\">";
                                                                                                                        foreach ($methodList as $method) {
                                                                                                                            $return .= "<option value=\"" . $method["id"] . "\">" . $method["method_name"] . "</option>";
                                                                                                                        }
                                                                                                                        $return .= "</select>\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group\">Bonus tutarı (%)</label>\n            <input type=\"text\" name=\"amount\" class=\"form-control\" value=\"\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group\">İtibaren (<i class=\"fa fa-try\"></i>)</label>\n            <input type=\"text\" name=\"from\" class=\"form-control\" value=\"\">\n          </div>\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Yeni bonusu ekle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                                        echo json_encode(["content" => $return, "title" => "Yeni ödeme bonusu"]);
                                                                                                                    } else {
                                                                                                                        if ($action == "edit_paymentbonus") {
                                                                                                                            $id = $_POST["id"];
                                                                                                                            $bonus = $conn->prepare("SELECT * FROM payments_bonus WHERE bonus_id=:id ");
                                                                                                                            $bonus->execute(["id" => $id]);
                                                                                                                            $bonus = $bonus->fetch(PDO::FETCH_ASSOC);
                                                                                                                            $methodList = $conn->prepare("SELECT * FROM payment_methods  WHERE id!='4' ");
                                                                                                                            $methodList->execute([]);
                                                                                                                            $methodList = $methodList->fetchAll(PDO::FETCH_ASSOC);
                                                                                                                            $return = "<form class=\"form\" action=\"" . site_url("admin/settings/payment-bonuses/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\n        <div class=\"modal-body\">\n\n          <div class=\"form-group\">\n          <label>Method</label>\n            <select class=\"form-control\" name=\"method_type\">";
                                                                                                                            foreach ($methodList as $method) {
                                                                                                                                $return .= "<option value=\"" . $method["id"] . "\"";
                                                                                                                                if ($bonus["bonus_method"] == $method["id"]) {
                                                                                                                                    $return .= "selected";
                                                                                                                                }
                                                                                                                                $return .= ">" . $method["method_name"] . "</option>";
                                                                                                                            }
                                                                                                                            $return .= "</select>\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group\">Bonus tutarı (%)</label>\n            <input type=\"text\" name=\"amount\" class=\"form-control\" value=\"" . $bonus["bonus_amount"] . "\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group\">İtibaren (<i class=\"fa fa-try\"></i>)</label>\n            <input type=\"text\" name=\"from\" class=\"form-control\" value=\"" . $bonus["bonus_from"] . "\">\n          </div>\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <a id=\"delete-row\" data-url=\"" . site_url("admin/settings/payment-bonuses/delete/" . $bonus["bonus_id"]) . "\" class=\"btn btn-danger pull-left\">Bonusu kaldır</a>\n            <button type=\"submit\" class=\"btn btn-primary\">Bonusu güncelle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>\n          <script src=\"https://unpkg.com/sweetalert/dist/sweetalert.min.js\"></script>\n          <script>\n          \$(\"#delete-row\").click(function(){\n            var action = \$(this).attr(\"data-url\");\n            swal({\n              title: \"Silmek istediğinizden emin misiniz?\",\n              text: \"Eğer onaylarsanız bu içerik silinecek, bunu geri getirmek mümkün olmayabilir.\",\n              icon: \"warning\",\n              buttons: true,\n              dangerMode: true,\n              buttons: [\"Vazgeç\", \"Evet, eminim!\"],\n            })\n            .then((willDelete) => {\n              if (willDelete) {\n                \$.ajax({\n                  url:  action,\n                  type: \"GET\",\n                  dataType: \"json\",\n                  cache: false,\n                  contentType: false,\n                  processData: false\n                })\n                .done(function(result){\n                  if( result.s == \"error\" ){\n                    var heading = \"Başarısız\";\n                  }else{\n                    var heading = \"Başarılı\";\n                  }\n                    \$.toast({\n                        heading: heading,\n                        text: result.m,\n                        icon: result.s,\n                        loader: true,\n                        loaderBg: \"#9EC600\"\n                    });\n                    if (result.r!=null) {\n                      if( result.time ==null ){ result.time = 3; }\n                      setTimeout(function(){\n                        window.location.href  = result.r;\n                      },result.time*1000);\n                    }\n                })\n                .fail(function(){\n                  \$.toast({\n                      heading: \"Başarısız\",\n                      text: \"İstek gerçekleştirilemedi\",\n                      icon: \"error\",\n                      loader: true,\n                      loaderBg: \"#9EC600\"\n                  });\n                });\n                /* İçerik silinmesi onaylandı */\n              } else {\n                \$.toast({\n                    heading: \"Başarısız\",\n                    text: \"Silinme istediği reddedildi\",\n                    icon: \"error\",\n                    loader: true,\n                    loaderBg: \"#9EC600\"\n                });\n              }\n            });\n          });\n          </script>\n          ";
                                                                                                                            echo json_encode(["content" => $return, "title" => "Ödeme bonusu güncelle"]);
                                                                                                                        } else {
                                                                                                                            if ($action == "new_provider") {
                                                                                                                                $return = "<form class=\"form\" action=\"" . site_url("admin/settings/providers/new") . "\" method=\"post\" data-xhr=\"true\">\n\n        <div class=\"modal-body\">\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Sağlayıcı Adı</label>\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"\">\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Sağlayıcı API Tipi</label>\n              <select class=\"form-control\" name=\"type\">\n                    <option value=\"1\">Standart</option>\n                    <option value=\"3\">Socials.media</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">API URL</label>\n            <input type=\"text\" class=\"form-control\" name=\"url\" value=\"\">\n          </div>\n\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">API Key</label>\n            <input type=\"text\" class=\"form-control\" name=\"apikey\" value=\"\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Bakiye Limit</label>\n            <input type=\"text\" class=\"form-control\" name=\"limit\" value=\"\">\n          </div>\n\n          <hr>\n            <p class=\"card-description\">\n              <ul>\n                <li>\n                  Bakiye Limit: <code>Bakiyeniz bu tutarın altına düşerse bildirim alacaksınız.</code>\n                </li>\n              </ul>\n            </p>\n          <hr>\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Sağlayıcıyı ekle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                                                echo json_encode(["content" => $return, "title" => "Yeni sağlayıcı ekle"]);
                                                                                                                            } else {
                                                                                                                                if ($action == "edit_provider") {
                                                                                                                                    $id = $_POST["id"];
                                                                                                                                    $provider = $conn->prepare("SELECT * FROM service_api WHERE id=:id ");
                                                                                                                                    $provider->execute(["id" => $id]);
                                                                                                                                    $provider = $provider->fetch(PDO::FETCH_ASSOC);
                                                                                                                                    $return = "<form class=\"form\" action=\"" . site_url("admin/settings/providers/edit/" . $id) . "\" method=\"post\" data-xhr=\"true\">\n\n        <div class=\"modal-body\">\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Sağlayıcı Adı</label>\n            <input type=\"text\" class=\"form-control\" name=\"name\" value=\"" . $provider["api_name"] . "\">\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Sağlayıcı API Tipi</label>\n              <select class=\"form-control\" name=\"type\">\n                    <option value=\"1\"";
                                                                                                                                    if ($provider["api_type"] == 1) {
                                                                                                                                        $return .= "selected";
                                                                                                                                    }
                                                                                                                                    $return .= ">Standart</option>\n                    <option value=\"3\"";
                                                                                                                                    if ($provider["api_type"] == 3) {
                                                                                                                                        $return .= "selected";
                                                                                                                                    }
                                                                                                                                    $return .= ">Socials.media</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">API URL</label>\n            <input type=\"text\" class=\"form-control\" name=\"url\" value=\"" . $provider["api_url"] . "\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">API Key</label>\n            <input type=\"text\" class=\"form-control\" name=\"apikey\" value=\"" . $provider["api_key"] . "\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Bakiye Limit</label>\n            <input type=\"text\" class=\"form-control\" name=\"limit\" value=\"" . $provider["api_limit"] . "\">\n          </div>\n\n          <hr>\n            <p class=\"card-description\">\n              <ul>\n                <li>\n                  Bakiye Limit: <code>Bakiyeniz bu tutarın altına düşerse bildirim alacaksınız.</code>\n                </li>\n              </ul>\n            </p>\n          <hr>\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Sağlayıcıyı düzenle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                                                    echo json_encode(["content" => $return, "title" => "Sağlayıcı düzenle (" . $provider["api_name"] . ") "]);
                                                                                                                                } else {
                                                                                                                                    if ($action == "export_user") {
                                                                                                                                        $return = "<form class=\"form\" action=\"" . site_url("admin/clients/export") . "\" method=\"post\">\n        <div class=\"modal-body\">\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Üyelik Statu</label>\n              <select class=\"form-control\" name=\"client_status\">\n                    <option value=\"all\">Tüm üyeler</option>\n                    <option value=\"1\">Pasif</option>\n                    <option value=\"2\">Aktif</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Email Statu</label>\n              <select class=\"form-control\" name=\"email_status\">\n                    <option value=\"all\">Tüm üyeler</option>\n                    <option value=\"1\">Onaysız</option>\n                    <option value=\"2\">Onaylı</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Format</label>\n              <select class=\"form-control\" name=\"format\">\n                    <option value=\"json\">JSON</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Üye bilgileri</label>\n              <div class=\"form-group\">\n                  <label class=\"checkbox-inline\">\n                    <input type=\"checkbox\" class=\"access\" name=\"exportcolumn[client_id]\" checked value=\"1\"> ID\n                  </label>\n                  <label class=\"checkbox-inline\">\n                    <input type=\"checkbox\" class=\"access\" name=\"exportcolumn[email]\" checked value=\"1\"> Email\n                  </label>\n                  <label class=\"checkbox-inline\">\n                    <input type=\"checkbox\" class=\"access\" name=\"exportcolumn[name]\" checked value=\"1\"> Ad Soyad\n                  </label>\n                  <label class=\"checkbox-inline\">\n                    <input type=\"checkbox\" class=\"access\" name=\"exportcolumn[username]\" checked value=\"1\"> Kullanıcı adı\n                  </label>\n                  <label class=\"checkbox-inline\">\n                    <input type=\"checkbox\" class=\"access\" name=\"exportcolumn[telephone]\" checked value=\"1\"> Telefon numarası\n                  </label>\n                  <label class=\"checkbox-inline\">\n                    <input type=\"checkbox\" class=\"access\" name=\"exportcolumn[balance]\" checked value=\"1\"> Bakiye\n                  </label>\n                  <label class=\"checkbox-inline\">\n                    <input type=\"checkbox\" class=\"access\" name=\"exportcolumn[spent]\" checked value=\"1\"> Harcama\n                  </label>\n                  <label class=\"checkbox-inline\">\n                    <input type=\"checkbox\" class=\"access\" name=\"exportcolumn[register_date]\" checked value=\"1\"> Kayıt tarihi\n                  </label>\n                  <label class=\"checkbox-inline\">\n                    <input type=\"checkbox\" class=\"access\" name=\"exportcolumn[login_date]\" checked value=\"1\"> Son giriş tarihi\n                  </label>\n              </div>\n            </div>\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Kullanıcıları yedekle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                                                        echo json_encode(["content" => $return, "title" => "Kullanıcıları yedekle"]);
                                                                                                                                    } else {
                                                                                                                                        if ($action == "all_numbers") {
                                                                                                                                            $rows = $conn->prepare("SELECT * FROM clients");
                                                                                                                                            $rows->execute([]);
                                                                                                                                            $rows = $rows->fetchAll(PDO::FETCH_ASSOC);
                                                                                                                                            $numbers = "";
                                                                                                                                            $emails = "";
                                                                                                                                            foreach ($rows as $row) {
                                                                                                                                                if ($row["telephone"]) {
                                                                                                                                                    $numbers .= $row["telephone"] . "\n";
                                                                                                                                                }
                                                                                                                                                $emails .= $row["email"] . "\n";
                                                                                                                                            }
                                                                                                                                            $return = "<form>\n        <div class=\"modal-body\">\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Üye Telefon Numaraları</label>\n              <textarea class=\"form-control\" rows=\"8\" readonly>" . $numbers . "</textarea>\n            </div>\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Üye E-mail Adresleri</label>\n              <textarea class=\"form-control\" rows=\"8\" readonly>" . $emails . "</textarea>\n            </div>\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                                                            echo json_encode(["content" => $return, "title" => "Kullanıcı Bilgileri"]);
                                                                                                                                        } else {
                                                                                                                                            if ($action == "details") {
                                                                                                                                                $toplamkullanici = $conn->prepare("SELECT * FROM clients");
                                                                                                                                                $toplamkullanici->execute();
                                                                                                                                                $toplamkullanici = $toplamkullanici->rowCount();
                                                                                                                                                $query = $conn->query("SELECT sum(balance) as toplambakiye FROM clients")->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                $query2 = $conn->query("SELECT sum(order_charge) as order_charge FROM orders")->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                $negatifbakiye = $conn->prepare("SELECT * FROM clients where balance < 0");
                                                                                                                                                $negatifbakiye->execute();
                                                                                                                                                $negatifbakiye = $negatifbakiye->rowCount();
                                                                                                                                                $bakiyesiz = $conn->prepare("SELECT * FROM clients where balance = 0");
                                                                                                                                                $bakiyesiz->execute();
                                                                                                                                                $bakiyesiz = $bakiyesiz->rowCount();
                                                                                                                                                $return = "<form>\n        <div class=\"modal-body\">\n\t\t\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Toplam Kullanıcı : " . $toplamkullanici . "</label>\n            </div>\n          </div>\n\t\t  \n\t\t  <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Toplam Kullanılabilir Bakiye : " . $query["toplambakiye"] . "</label>\n            </div>\n          </div>\n\t\t  \n\t\t  <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Toplam Harcanan Bakiye : " . $query2["order_charge"] . "</label>\n            </div>\n          </div>\n\t\t  \n\t\t  <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Negatif Bakiyeli Kullanıcı : " . $negatifbakiye . "</label>\n            </div>\n          </div>\n\t\t  \n\t\t  <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Bakiyesi Sıfır Olan Kullanıcı : " . $bakiyesiz . "</label>\n            </div>\n          </div>\n\t\t  \n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                                                                echo json_encode(["content" => $return, "title" => "Detaylar"]);
                                                                                                                                            } else {
                                                                                                                                                if ($action == "price_user") {
                                                                                                                                                    $id = $_POST["id"];
                                                                                                                                                    $price = $conn->prepare("SELECT *,services.service_id as serviceid,services.service_price as price,clients_price.service_price as clientprice FROM services LEFT JOIN clients_price ON clients_price.service_id=services.service_id && clients_price.client_id=:id ");
                                                                                                                                                    $price->execute(["id" => $id]);
                                                                                                                                                    $price = $price->fetchAll(PDO::FETCH_ASSOC);
                                                                                                                                                    $return = "<form class=\"form\" action=\"" . site_url("admin/clients/price/" . $id) . "\" method=\"post\" data-xhr=\"true\">\n        <div class=\"modal-body\">\n\n        <div class=\"services-import__body\">\n               <div>\n                  <div class=\"services-import__list-wrap services-import__list-active\">\n                     <div class=\"services-import__scroll-wrap\">\n                        <span>\n                             <div class=\"services-import__packages\">\n                                <ul>";
                                                                                                                                                    foreach ($price as $row) {
                                                                                                                                                        $return .= "<li id=\"service-" . $row["serviceid"] . "\">\n                                     <label>\n                                        " . $row["serviceid"] . " - " . $row["service_name"] . "\n                                        <span class=\"services-import__packages-price-edit\" >\n                                           <div class=\"services-import__packages-price-lock\"  data-id=\"servicedelete-" . $row["serviceid"] . "\" data-service=\"" . $row["serviceid"] . "\">\n                                             <span class=\"fa fa-trash\"></span>\n                                           </div>\n                                           <input type=\"text\" class=\"services-import__price\" name=\"price[" . $row["serviceid"] . "]\" value=\"" . $row["clientprice"] . "\">\n                                           <span class=\"services-import__provider-price\">" . $row["price"] . "</span>\n                                        </span>\n                                     </label>\n                                    </li>";
                                                                                                                                                    }
                                                                                                                                                    $return .= "</ul>\n                             </div>\n                          </span></div>\n                  </div>\n               </div>\n            </div>\n            <script>\n\n              \$('[data-id^=\"servicedelete-\"]').click(function(){\n                var id        = \$(this).attr(\"data-service\");\n                \$(\"[name='price[\"+id+\"]']\").val(\"\");\n                //\$(\"ul > li#service-\"+id).remove();\n              });\n\n            </script>\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                                                                    echo json_encode(["content" => $return, "title" => "Özel Fiyatlandırma"]);
                                                                                                                                                } else {
                                                                                                                                                    if ($action == "order_errors") {
                                                                                                                                                        $id = $_POST["id"];
                                                                                                                                                        $row = $conn->prepare("SELECT * FROM orders WHERE order_id=:id ");
                                                                                                                                                        $row->execute(["id" => $id]);
                                                                                                                                                        $row = $row->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                        $errors = json_decode($row["order_error"]);
                                                                                                                                                        $return = "<form>\n        <div class=\"modal-body\">\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Sağlayıcıdan gelen bilgi</label>\n              <textarea class=\"form-control\" rows=\"8\" readonly>";
                                                                                                                                                        $return .= print_r($errors, true);
                                                                                                                                                        $return .= "</textarea>\n            </div>\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                                                                        echo json_encode(["content" => $return, "title" => "Hata detayları (ID: " . $row["order_id"] . ") "]);
                                                                                                                                                    } else {
                                                                                                                                                        if ($action == "order_details") {
                                                                                                                                                            $id = $_POST["id"];
                                                                                                                                                            $row = $conn->prepare("SELECT * FROM orders WHERE order_id=:id ");
                                                                                                                                                            $row->execute(["id" => $id]);
                                                                                                                                                            $row = $row->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                            $detail = json_decode($row["order_detail"]);
                                                                                                                                                            $return = "<form>\n        <div class=\"modal-body\">\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Sağlayıcıdan gelen bilgi</label>\n              <textarea class=\"form-control\" rows=\"8\" readonly>";
                                                                                                                                                            $return .= print_r($detail, true);
                                                                                                                                                            $return .= "</textarea>\n            </div>\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Sipariş ID</label>\n              <input class=\"form-control\" value=\"" . $row["api_orderid"] . "\" readonly>\n            </div>\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Son güncelleme</label>\n              <input class=\"form-control\" value=\"" . $row["last_check"] . "\" readonly>\n            </div>\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                                                                            echo json_encode(["content" => $return, "title" => "Sipariş detayları (ID: " . $row["order_id"] . ") "]);
                                                                                                                                                        } else {
                                                                                                                                                            if ($action == "order_orderurl") {
                                                                                                                                                                $id = $_POST["id"];
                                                                                                                                                                $row = $conn->prepare("SELECT * FROM orders WHERE order_id=:id ");
                                                                                                                                                                $row->execute(["id" => $id]);
                                                                                                                                                                $row = $row->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                $detail = json_decode($row["order_detail"]);
                                                                                                                                                                $return = "<form class=\"form\" action=\"" . site_url("admin/orders/set_orderurl/" . $id) . "\" method=\"post\">\n        <div class=\"modal-body\">\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Sipariş Bağlantısı</label>\n              <input class=\"form-control\" value=\"" . $row["order_url"] . "\" name=\"url\">\n            </div>\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                                                                                echo json_encode(["content" => $return, "title" => "Sipariş detayları (ID: " . $row["order_id"] . ") "]);
                                                                                                                                                            } else {
                                                                                                                                                                if ($action == "order_startcount") {
                                                                                                                                                                    $id = $_POST["id"];
                                                                                                                                                                    $row = $conn->prepare("SELECT * FROM orders WHERE order_id=:id ");
                                                                                                                                                                    $row->execute(["id" => $id]);
                                                                                                                                                                    $row = $row->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                    $detail = json_decode($row["order_detail"]);
                                                                                                                                                                    $return = "<form class=\"form\" action=\"" . site_url("admin/orders/set_startcount/" . $id) . "\" method=\"post\">\n        <div class=\"modal-body\">\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Başlangıç sayısı</label>\n              <input class=\"form-control\" value=\"" . $row["order_start"] . "\" name=\"start\">\n            </div>\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                                                                                    echo json_encode(["content" => $return, "title" => "Sipariş detayları (ID: " . $row["order_id"] . ") "]);
                                                                                                                                                                } else {
                                                                                                                                                                    if ($action == "order_partial") {
                                                                                                                                                                        $id = $_POST["id"];
                                                                                                                                                                        $row = $conn->prepare("SELECT * FROM orders WHERE order_id=:id ");
                                                                                                                                                                        $row->execute(["id" => $id]);
                                                                                                                                                                        $row = $row->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                        $detail = json_decode($row["order_detail"]);
                                                                                                                                                                        $return = "<form class=\"form\" action=\"" . site_url("admin/orders/set_partial/" . $id) . "\" method=\"post\" data-xhr=\"true\">\n        <div class=\"modal-body\">\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Gitmeyen miktar</label>\n              <input class=\"form-control\" name=\"remains\">\n            </div>\n          </div>\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                                                                                        echo json_encode(["content" => $return, "title" => "Sipariş detayları (ID: " . $row["order_id"] . ") "]);
                                                                                                                                                                    } else {
                                                                                                                                                                        if ($action == "subscriptions_expiry") {
                                                                                                                                                                            $id = $_POST["id"];
                                                                                                                                                                            $row = $conn->prepare("SELECT * FROM orders WHERE order_id=:id ");
                                                                                                                                                                            $row->execute(["id" => $id]);
                                                                                                                                                                            $row = $row->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                            $detail = json_decode($row["order_detail"]);
                                                                                                                                                                            $return = "<form class=\"form\" action=\"" . site_url("admin/subscriptions/set_expiry/" . $id) . "\" method=\"post\">\n        <div class=\"modal-body\">\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Başlangıç sayısı</label>\n              <input class=\"form-control datetime\" value=\"";
                                                                                                                                                                            if ($row["subscriptions_expiry"] != "1970-01-01") {
                                                                                                                                                                                $return .= date("d/m/Y", strtotime($row["subscriptions_expiry"]));
                                                                                                                                                                            }
                                                                                                                                                                            $return .= "\" name=\"expiry\">\n            </div>\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>\n          <link rel=\"stylesheet\" type=\"text/css\" href=\"" . site_url("public/") . "datepicker/css/bootstrap-datepicker3.min.css\">\n          <script type=\"text/javascript\" src=\"" . site_url("public/") . "datepicker/js/bootstrap-datepicker.min.js\"></script>\n          <script type=\"text/javascript\" src=\"" . site_url("public/") . "datepicker/locales/bootstrap-datepicker.tr.min.js\"></script>\n          ";
                                                                                                                                                                            echo json_encode(["content" => $return, "title" => "Abonelik bitiş tarihi (ID: " . $row["order_id"] . ") "]);
                                                                                                                                                                        } else {
                                                                                                                                                                            if ($action == "payment_bankedit") {
                                                                                                                                                                                $id = $_POST["id"];
                                                                                                                                                                                $payment = $conn->prepare("SELECT * FROM payments INNER JOIN bank_accounts ON bank_accounts.id=payments.payment_bank INNER JOIN clients ON clients.client_id=payments.client_id WHERE payments.payment_id=:id");
                                                                                                                                                                                $payment->execute(["id" => $id]);
                                                                                                                                                                                $payment = $payment->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                                $bank = $conn->prepare("SELECT * FROM bank_accounts ");
                                                                                                                                                                                $bank->execute();
                                                                                                                                                                                $bank = $bank->fetchAll(PDO::FETCH_ASSOC);
                                                                                                                                                                                $return = "<form class=\"form\" action=\"" . site_url("admin/payments/edit-bank/" . $id) . "\" method=\"post\" data-xhr=\"true\">\n\n        <div class=\"modal-body\">\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Ödeme yapılan banka</label>\n              <select class=\"form-control\" name=\"bank\">";
                                                                                                                                                                                foreach ($bank as $banka) {
                                                                                                                                                                                    $return .= "<option value=\"" . $banka["id"] . "\"";
                                                                                                                                                                                    if ($payment["payment_bank"] == $banka["id"]) {
                                                                                                                                                                                        $return .= "selected";
                                                                                                                                                                                    }
                                                                                                                                                                                    $return .= ">" . $banka["bank_name"] . "</option>";
                                                                                                                                                                                }
                                                                                                                                                                                $return .= "</select>\n            </div>\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Ödeme durumu</label>\n              <select class=\"form-control\" ";
                                                                                                                                                                                if ($payment["payment_status"] == 3) {
                                                                                                                                                                                    $return .= "disabled";
                                                                                                                                                                                }
                                                                                                                                                                                $return .= " name=\"status\">\n                    <option value=\"1\"";
                                                                                                                                                                                if ($payment["payment_status"] == 1) {
                                                                                                                                                                                    $return .= "selected";
                                                                                                                                                                                }
                                                                                                                                                                                $return .= ">Beklemede</option>\n                    <option value=\"2\"";
                                                                                                                                                                                if ($payment["payment_status"] == 2) {
                                                                                                                                                                                    $return .= "selected";
                                                                                                                                                                                }
                                                                                                                                                                                $return .= ">İptal</option>\n                    <option value=\"3\"";
                                                                                                                                                                                if ($payment["payment_status"] == 3) {
                                                                                                                                                                                    $return .= "selected";
                                                                                                                                                                                }
                                                                                                                                                                                $return .= ">Onaylandı</option>\n                </select>\n            </div>\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">NOT</label>\n            <input type=\"text\" class=\"form-control\" name=\"note\" value=\"" . $payment["payment_note"] . "\">\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                                                                                                echo json_encode(["content" => $return, "title" => "Banka ödemesi düzenle (ID: " . $id . ") "]);
                                                                                                                                                                            } else {
                                                                                                                                                                                if ($action == "payment_banknew") {
                                                                                                                                                                                    $bank = $conn->prepare("SELECT * FROM bank_accounts ");
                                                                                                                                                                                    $bank->execute();
                                                                                                                                                                                    $bank = $bank->fetchAll(PDO::FETCH_ASSOC);
                                                                                                                                                                                    $return = "<form class=\"form\" action=\"" . site_url("admin/payments/new-bank/") . "\" method=\"post\" data-xhr=\"true\">\n\n        <div class=\"modal-body\">\n\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Kullanıcı adı</label>\n            <input type=\"text\" class=\"form-control\" name=\"username\" value=\"\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Tutar</label>\n            <input type=\"text\" class=\"form-control\" name=\"amount\" value=\"\">\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Ödeme yapılan banka</label>\n              <select class=\"form-control\" name=\"bank\">";
                                                                                                                                                                                    foreach ($bank as $banka) {
                                                                                                                                                                                        $return .= "<option value=\"" . $banka["id"] . "\">" . $banka["bank_name"] . "</option>";
                                                                                                                                                                                    }
                                                                                                                                                                                    $return .= "</select>\n            </div>\n          </div>\n\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">NOT</label>\n            <input type=\"text\" class=\"form-control\" name=\"note\" value=\"\">\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Ödeme ekle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                                                                                                    echo json_encode(["content" => $return, "title" => "Banka ödemesi ekle "]);
                                                                                                                                                                                } else {
                                                                                                                                                                                    if ($action == "payment_edit") {
                                                                                                                                                                                        $id = $_POST["id"];
                                                                                                                                                                                        $payment = $conn->prepare("SELECT * FROM payments INNER JOIN clients ON clients.client_id=payments.client_id WHERE payments.payment_id=:id");
                                                                                                                                                                                        $payment->execute(["id" => $id]);
                                                                                                                                                                                        $payment = $payment->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                                        $methods = $conn->prepare("SELECT * FROM payment_methods WHERE id!='4' ");
                                                                                                                                                                                        $methods->execute();
                                                                                                                                                                                        $methods = $methods->fetchAll(PDO::FETCH_ASSOC);
                                                                                                                                                                                        $return = "<form class=\"form\" action=\"" . site_url("admin/payments/edit-online/" . $id) . "\" method=\"post\" data-xhr=\"true\">\n\n        <div class=\"modal-body\">\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Ödeme yöntemi</label>\n              <select class=\"form-control\" name=\"method\">";
                                                                                                                                                                                        foreach ($methods as $method) {
                                                                                                                                                                                            $return .= "<option value=\"" . $method["id"] . "\"";
                                                                                                                                                                                            if ($payment["payment_method"] == $method["id"]) {
                                                                                                                                                                                                $return .= "selected";
                                                                                                                                                                                            }
                                                                                                                                                                                            $return .= ">" . $method["method_name"] . "</option>";
                                                                                                                                                                                        }
                                                                                                                                                                                        $return .= "</select>\n            </div>\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">NOT</label>\n            <input type=\"text\" class=\"form-control\" name=\"note\" value=\"" . $payment["payment_note"] . "\">\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Ayarları güncelle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                                                                                                        echo json_encode(["content" => $return, "title" => "Online ödeme düzenle (ID: " . $id . ") "]);
                                                                                                                                                                                    } else {
                                                                                                                                                                                        if ($action == "payment_new") {
                                                                                                                                                                                            $methods = $conn->prepare("SELECT * FROM payment_methods WHERE id!='4' ");
                                                                                                                                                                                            $methods->execute();
                                                                                                                                                                                            $methods = $methods->fetchAll(PDO::FETCH_ASSOC);
                                                                                                                                                                                            $return = "<form class=\"form\" action=\"" . site_url("admin/payments/new-online") . "\" method=\"post\" data-xhr=\"true\">\n\n        <div class=\"modal-body\">\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Kullanıcı adı</label>\n            <input type=\"text\" class=\"form-control\" name=\"username\" value=\"\">\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">Tutar</label>\n            <input type=\"text\" class=\"form-control\" name=\"amount\" value=\"\">\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Ekle/Çıkar</label>\n              <select class=\"form-control\" name=\"add-remove\">\n                <option value=\"add\">Ekle</option>\n                <option value=\"remove\">Çıkar</option>\n            </select>\n            </div>\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Ödeme yöntemi</label>\n              <select class=\"form-control\" name=\"method\">";
                                                                                                                                                                                            foreach ($methods as $method) {
                                                                                                                                                                                                $return .= "<option value=\"" . $method["id"] . "\">" . $method["method_name"] . "</option>";
                                                                                                                                                                                            }
                                                                                                                                                                                            $return .= "</select>\n            </div>\n          </div>\n\n          <div class=\"form-group\">\n            <label class=\"form-group__service-name\">NOT</label>\n            <input type=\"text\" class=\"form-control\" name=\"note\" value=\"\">\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"submit\" class=\"btn btn-primary\">Ödeme ekle</button>\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                                                                                                            echo json_encode(["content" => $return, "title" => "Online ödeme ekle"]);
                                                                                                                                                                                        } else {
                                                                                                                                                                                            if ($action == "payment_detail") {
                                                                                                                                                                                                $id = $_POST["id"];
                                                                                                                                                                                                $row = $conn->prepare("SELECT * FROM payments WHERE payment_id=:id ");
                                                                                                                                                                                                $row->execute(["id" => $id]);
                                                                                                                                                                                                $row = $row->fetch(PDO::FETCH_ASSOC);
                                                                                                                                                                                                $detail = json_decode($row["payment_extra"]);
                                                                                                                                                                                                $return = "<form>\n        <div class=\"modal-body\">\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Ödeme bilgisi</label>\n              <textarea class=\"form-control\" rows=\"8\" readonly>";
                                                                                                                                                                                                $return .= print_r($detail, true);
                                                                                                                                                                                                $return .= "</textarea>\n            </div>\n          </div>\n\n          <div class=\"service-mode__block\">\n            <div class=\"form-group\">\n            <label>Son güncelleme</label>\n              <input class=\"form-control\" value=\"" . $row["payment_update_date"] . "\" readonly>\n            </div>\n          </div>\n\n\n        </div>\n\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Vazgeç</button>\n          </div>\n          </form>";
                                                                                                                                                                                                echo json_encode(["content" => $return, "title" => "Ödeme detayları (ID: " . $row["payment_id"] . ") "]);
                                                                                                                                                                                            }
                                                                                                                                                                                        }
                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
if (!$licence_control["licence"]) {
    echo (int) $hata;
    exit;
}

?>